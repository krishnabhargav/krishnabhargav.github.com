<!DOCTYPE html>
<html>
<head>   
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Vedhava Sodhi - Musings of a Software Engineer v2.0</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <!-- This is for syntax highlight -->
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

</head>
<body class="home-template">

    
    <header class="site-head" >
    <div class="vertical">
        <div class="site-head-content" class="inner">
            
            <h1 class="blog-title">Vedhava Sodhi</h1>
            <h2 class="blog-description"> 
                Musings of a Software Engineer v2.0. 
                
            </h2>
        </div>
    </div>
</header>

<main class="content" role="main">

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2014-06-02">02 Jun 2014</time> </span>
            <h2 class="post-title"><a href="/2014/06/02/Scala-once-again.html">Scala Once Again</a></h2>

        </header>
        <section class="post-excerpt">
            <h1>Scala, once again</h1>

        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2014-01-03">03 Jan 2014</time> </span>
            <h2 class="post-title"><a href="/2014/01/03/Few-handy-things-to-know-in-Go-Library-%28Command-line-arguments%2C-Reflection%2C-Setting-Bits%2C-Hash-functions%29.html">Few handy things to know in Go Library (Command line arguments, Reflection, Setting Bits, Hash functions)</a></h2>

        </header>
        <section class="post-excerpt">
            <h4>Command line arguments in Go</h4><div>In order to access the command line arguments passed to a Go executable, we work with the "flag" package from the standard Go library. Shown below is an example of passing command line arguments.<br /><pre name="code">go run cla.go Krishna</pre>Or if you have an executable obtained from go build, you can run it as<br /><pre name="code">./cla Krishna </pre>Shown below is an example go snippet that accesses the first argument passed &amp; prints it.<br /><pre class="c" name="code">package main<br /><br />import (<br />    "fmt"<br />    "flag"<br />)<br /><br />func main() {<br /> //Without the call to Parse(), arguments may not be accessed<br /> flag.Parse()<br /> fmt.Printf("%s\n",flag.Arg(0))<br />}</pre>Notice that you will have to invoke the call to flag.Parse() without which you will not be able to access the arguments.<br /><br /><h4>Reflection support in Go</h4></div><div>We take the previous example, add some code for reflection which will help us understand how reflection library may be used. Just some simple example without having to go deep. For that, read this <a href="http://blog.golang.org/laws-of-reflection">post from the official Go blog</a>.  <br /><br />So what is the type returned by flag.Arg(0) ? We will start from there and go use some functions.<br /><pre class="c" name="code">package main<br /><br />import (<br /> "fmt" //regular format package<br /> "flag" //package from command line arguments<br /> "reflect" //package for reflection<br />)<br /><br />func main() {<br /> //Without the call to Parse(), arguments may not be accessed<br /> flag.Parse()<br /> fmt.Printf("%s\n",flag.Arg(0))<br /><br /> passed := flag.Arg(0)<br /> //TypeOf actually returns a Type type<br /> fmt.Println("typeof : ",reflect.TypeOf(passed))<br /><br /> //ValueOf actually returns a Value<br /> fmt.Println("valueof : ",reflect.ValueOf(passed))<br /><br /> //Example functions from the Value type<br /> fmt.Println("type: ",reflect.ValueOf(passed).Type())<br /> fmt.Println("kind: ", reflect.ValueOf(passed).Kind())<br /> fmt.Println("interface:", reflect.ValueOf(passed).Interface())<br />}<br /><br /></pre><h4>Big Integer &amp; Set Bits</h4></div><div>In the future post, I would like to implement a Bloom filter in Go but for that I will need to know how to do the following:</div><div>- Create a big number and set some bit "x" to 1 or 0.</div><div>- Accept a string, convert it to byte array, then hash the byte array.</div><div><br /></div><div>To support the above, I wanted to see how simple big numbers would work. I am only looking enough to support my purpose.&nbsp;</div><div><br /></div><div>Big Numbers (multi-precision numbers) are supported using "math/big" package in Go library. Shown below is an example code that does that.</div><pre class="c" name="code">package main<br /><br />import ( <br />   "fmt"<br />   "math/big"</pre><pre class="c" name="code">   "unsafe"<br />)<br /><br />func main() {<br /> <br /> //create a new big integer<br /> filter := big.NewInt(0)<br /><br /> fmt.Println("filter value: ",filter)<br /> <br /> //accessing the sizeof from unsafe package<br /> fmt.Println("size of : ",unsafe.Sizeof(filter))<br /> <br /> //example of how to cast uintptr to int<br /> filter.SetBit(filter,int(unsafe.Sizeof(filter)*8)-1,1)<br /> <br /> fmt.Println("filter after setbit last to 1 : ",filter)<br />}<br /></pre><br />The above example shows a few things:<br />- Creating an instance of big.Int using the NewInt() call.<br />- Accessing the size of the big.Int using unsafe package exported SizeOf() function<br />- SizeOf() returns uintptr and we convert that to integer - that is a good example of casting<br />- How to set bit on the big.Int using SetBit<br /><br /><h4>Working with Hash functions</h4><div>Example below demonstrates the following</div><div><ul><li>how to convert a string to a byte array</li><li>how to use FNV Hash from the standard Go library</li></ul></div><pre class="c" name="code">package main<br /><br />import (<br /> "fmt"<br /> "hash/fnv"<br />)<br /><br />func main() {<br />        //Create a hash fnv function<br /> hash := fnv.New32()<br /> <br /> name := "Krishna"<br /><br /> //converting string to byte array<br /> namebytes := []byte(name)<br /><br /> fmt.Println("hash reset : ",hash.Sum32())<br /> <br /> hash.Write(namebytes)<br /><br /> fmt.Println("hash of Krishna : ",hash.Sum32())<br /><br /> hash.Reset() //resets the hash<br /><br /> fmt.Println("hash reset : ",hash.Sum32())<br /><br /> //write again<br /> hash.Write(namebytes)<br /> <br /> fmt.Println("hash of Krishna : ", hash.Sum32())<br />}<br /></pre>Hash libraries in the Go "hash" package implements the Hash interface. The implementations in the standard Go library as of this time are adler32, crc32, crc64, fnv-1/fnv-1a. The above example creates an instance of FNV hash, writes a byte array to it and then gets the value through Sum32() call. You can "forget" what is written to it by Reset() function which will allow you to reuse the hash instance.<br /><br />I am newly learning Go and along the way sharing some things that I learnt. If you know of a better way to accomplish what I have shared here, please feel free to comment.


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2014-01-02">02 Jan 2014</time> </span>
            <h2 class="post-title"><a href="/2014/01/02/Working-with-%22Packages%22-in-Go-language.html">Working with "Packages" in Go language</a></h2>

        </header>
        <section class="post-excerpt">
            Packages in Golang<br /><br />The specification states that all source files for a package be stored in the same directory.<br />You can import a package as shown below.<br /><br /><pre name="code">import "fmt"<br /></pre><br />In this case, the Printf method may be accessed as fmt.Printf(). All other identifiers exported by the package is also accessible as fmt.XXXX().<br /><br />You can also do the following.<br /><br /><pre>import f "fmt"</pre>In this case, the qualifier is "f" instead of the default "fmt". So you access as "f.Printf()".<br /><br />One other way is the following. <br /><pre> import . "fmt" </pre>In this case, you dont need a qualifier for the exported identifiers from the fmt package. You may also use the blank identifier (underscore : _) as the qualifier name for cases where you wish the initialize the package but not necessarily import its exported identifiers. <br />Source files of a package have an init() function. See below for more details.<br />The previous example of a simple Web Server is now split into two files  <br /><pre class="c" name="code">//GoWebServer.go<br />package main<br /><br />import f "fmt"<br /><br />//init() is a special function that gets initialized.<br />func init(){<br /> f.Printf ("Package Initialized\n")<br />}<br /><br />func main() {<br /> f.Printf("Web Server will be started at port 8080\n")<br /> runWebServer()<br />}<br /></pre><pre class="c" name="code">//WebServerHelper.go<br /><br />package main<br /><br />import (<br /> . "fmt"<br /> "io"<br /> web "net/http"<br />)<br /><br />func init(){<br /> Printf("Initializing WebServerHelper.go \n")<br />}<br /><br />func runWebServer(){<br /> rootHandler := web.HandlerFunc(func(w web.ResponseWriter, r *web.Request) {<br />  io.WriteString(w, "Hi there, I love "+r.URL.Path)<br /> })<br /><br /> srv := web.Server{<br />  Handler: rootHandler,<br />  Addr:    ":8080",<br /> }<br /> srv.ListenAndServe()<br />}<br /></pre>Few things that I learnt when trying to make this work.<br />- You need to specify all the files required for your main program to build properly. So you may<br /><pre>go build</pre>Or you may run<br /><pre>go build *.go</pre>- You can also specify output to be generated as<br /><pre>go build -o output/gowebserver</pre>Or be more explicit<br /><pre>go build -o output/gowebserver *.go</pre>- Go complier does not like if a package is imported but not used. This is good. I cannot tell how annoying i find C# using statements that are just there but no one really uses them.<br /><div><br /></div><div>Notice that both the files have an init() function defined and when I build everything and run the program, the output is as follows:</div><pre>Package Initialized<br />Initializing WebServerHelper.go <br />Web Server will be started at port 8080<br /></pre><br />Such init() functions may be defined multiple times even in the same source file &amp; the execution order is unspecified/undefined. So we should not write our initialization logic based or the execution order. <br />And init() cannot be called by anyone else. Packages are initialized only once. So if you import packages P &amp; Q but Q also imports P, then P is initialized only once.<br /><br />Package initialization is comprised of variable initialization (package level variables are all assigned initial values) &amp; invocation of init() functions - performed one package at a time in a single go routine.<br /><br />See below for a basic program that indicates the above said sequence - variable initialization followed by init() method. <br /><pre class="c" name="code">package main<br /><br />import "fmt"<br /><br />//x := 2000<br />var x int = 2000<br /><br />func init(){<br /> var y int = x<br /> fmt.Printf("X value is %d\n",y)<br />}<br /><br />func main(){ }<br /></pre><br />x is a global variable (which by the way cannot use the shortcut notation that is commented) that is initialized to 2000 and that is what gets printed when the program is executed.<br /><h4>Local Packages in Go</h4>When you say <br /><pre>import "fmt" </pre>the package "fmt" is looked for in the standard Go tree. Then it is looked for in "$GOPATH/pkg" directory where $GOPATH is the environment variable set to some directory on your machine. Commands such as "go get" also looks for this directory. You can read more about it <a href="http://golang.org/pkg/go/build/">here (look for Go path)</a>.  So what about local packages - the one you do not want to put in GOPATH but leave it in the current directory for your application? To make this work, I renamed the package declaration (which originally was main) for the WebServerHelper.go as  <br /><pre>package ws</pre>Then I created a folder with the same name as the package &amp; placed the .go file in the folder. Then my import statements on the GoWebServer.go (the main file) has changed to  <br /><pre class="c" name="code">import (<br /> f "fmt"<br /> ws "./ws"<br />)<br /></pre>Notice the <b>"./ws"</b> declaration. So the import "XXX" statement says look for "XXX" file path. So without "./" it was looking in standard GO tree, then it looks at GOPATH. If there was a "./", it was just looking at the local directory. You may also give absolute paths. Also you don't need to build this directory specially. Just have your main file compile and you are good.  <br /><br />One other things that I had to change in the code to make the application work as before.<br />- In packages, if your function is to be exported, then it should start with upper case. In general, a field or a function or other identifiers within a package that starts with upper case letter are exported.  <br /><br />So if you are trying to make the previous code run (after the directory changes as described above), you will get the following<br /><br /><b>./GoWebServer.go:15: cannot refer to unexported name ws.runWebServer</b><br /><b>./GoWebServer.go:15: undefined: ws.runWebServer</b><br /><div><br /></div>So just change the name of the function to "RunWebServer" &amp; it becomes exported and ready to use.<br /><br />That's it for now!


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2013-12-31">31 Dec 2013</time> </span>
            <h2 class="post-title"><a href="/2013/12/31/Writing-some-Go%21-code.html">Writing some Go! code</a></h2>

        </header>
        <section class="post-excerpt">
            This post is my notes when writing some code in Go lang. To start off, I will write a Hello World program in Go language. &nbsp;See below. <br /><pre class="c" name="code">package main<br /><br />import "fmt"<br /><br />func main(){<br /> messageToPrint := "Welcome to Go!"<br /> fmt.Printf(messageToPrint + "\n")<br />}<br /></pre><br />Now to run this, you can do one of the following : <br /><pre class="powershell" name="code">go run HelloWorld.go<br /></pre>OR <br /><br /><pre class="powershell" name="code">go build HelloWorld.go<br /></pre>In the first case, "go run" compiles the program and runs it. It does not create an executable as such. (It could be creating a temporary executable somewhere.) The second command actually builds an executable which you can run.  Go also has a tool called "gofmt" which you can run directly as gofmt or can run as   <br /><pre class="powershell" name="code">go fmt HelloWorld.go </pre>.   The formatting tool formats your source code so that it matches the Go-defined formatting. This is a good thing as each one of us need not invent our own coding conventions.  Gofmt can also be used to perform some code refactoring. In order to perform a rename variable, the following command does the trick.  <br /><pre class="powershell" name="code">gofmt -l -w -r 'messageToPrint -&gt; mesg' ./HelloWorld.go </pre>The above command would rename the messageToPrint variable as mesg. In general, you pass 'pattern -&gt; replaceWith' style of commands when using the -r option.  More information on what gofmt -r can be used for is available in this <a href="http://www2.gli.cas.cz/home/cejchan/go/gofmt-r.pdf">presentation</a> &nbsp;  <br /><div><br /><b>Writing a Web Server in Go!</b><br /><br />The following code snippet shows a Web Server that is written in Go! and also shows how to write anonymous functions in Go!<br /><pre class="c" name="code">package main<br /><br />import (<br /> "fmt"<br /> "net/http"<br />)<br /><br />func main() {<br /> fmt.Printf("Web Server will be started at port 8080\n")<br />        //See below for anonymous function<br /> http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {<br />  fmt.Fprintf(w, "Hi there, I love %s!", r.URL.Path)<br /> })<br /> http.ListenAndServe(":8080", nil)<br />}<br /></pre><br />Now a better way (in my opinion) to write the same code as above is shown below.<br /><pre class="c" name="code">package main<br /><br />import (<br /> "fmt"<br /> "net/http"<br />)<br /><br />func main() {<br /> fmt.Printf("Web Server will be started at port 8080\n")<br /> rootHandler := http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {<br />  fmt.Fprintf(w, "Hi there, I love %s!", r.URL.Path)<br /> })<br /><br /> srv := http.Server{<br />  Handler: rootHandler,<br />  Addr:    ":8080",<br /> }<br /><br /> srv.ListenAndServe()<br />}<br /><br /></pre>In this example, we are actually creating an instance of a Http Server as opposed to the previous example where the http global helper methods were used to start the Http Web Service.<br /><br />I was just curious to see how well this naive web service performs. Using apache bench, when I run 10000 requests at concurrency level of 100-700, the sample (stupid) program can serve around 5000 requests/second on my age old laptop. Just for kicks, the server in Go is atleast 5 times faster for each request as compared to the nodejs http server.<br /><br />Back to Go! ..<br /><br /><ol><li>Package has to be "main" for your main program. Otherwise, it does not work.</li><li>Passing -x flag to your helper commands such as "go run", "go fmt" or "go build" will display the complete output and the commands internally executed.</li><li>The "go build" has all compiler optimizations enabled.</li></ol></div>


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2012-11-14">14 Nov 2012</time> </span>
            <h2 class="post-title"><a href="/2012/11/14/Hello-World%21-with-Scala-Web-Application-using-Play-2.0-and-Scalate.html">Hello World! with Scala Web Application using Play 2.0 and Scalate</a></h2>

        </header>
        <section class="post-excerpt">
            <p>In this post, we will look at how to make a hello-world web application in scala using the Play 2.0 Web Framework and change the template engine to work with Scalate. We assume your machine is all set up with Java and Scala configured. </p> <h3>Step 1 : DOWNLOAD AND CONFIGURE Play 2.0</h3> <p>Download the Play Framework 2.0 from <a title="http://download.playframework.org/releases/play-2.0.4.zip" href="http://download.playframework.org/releases/play-2.0.4.zip">http://download.playframework.org/releases/play-2.0.4.zip</a>. Then extract the zip file to some location. I put mine at C:\Development\tools\play-2.0.4\. <em>It is usually a good idea to leave the version number intact so as to easily know what version of any tool you are currently having on your machine.</em></p> <p>The configuration portion is pretty simple – <strong>Update your PATH environment variable to include the root directory of the play-2.0.4 folder which has the “play.bat” (I am running windows).</strong></p> <p>To verify, launch your command line or powershell and type the command “play”. You should see something like shown below.</p> <p><a href="http://lh6.ggpht.com/-NBtVsyBS4Ek/UKMcbf7BYiI/AAAAAAAABe4/PKzWPxA1NqA/s1600-h/image%25255B3%25255D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/-Q5sGyfo_XQA/UKMcc73XGsI/AAAAAAAABfA/NzZSaShb9yw/image_thumb%25255B1%25255D.png?imgmax=800" width="369" height="144"></a></p> <h2></h2> <h3>Step 2 : CREATE A NEW PLAY 2.0 WEB APPLICATION</h3> <p>Using command line (change directory – cd), go to a folder where you wish to place your application. Run the following command</p> <p><strong>play new helloworld-scalate</strong></p> <p>Here helloworld-scalate will be my application name. </p> <p>Then from the command line go into the “helloworld-scalate” folder. And then run the following command.</p> <p><strong>play run</strong></p> <p>The first time you run, it takes a few seconds to initialize the project and upon success, you will see on-screen instructions that the application is hosted at 9000 port on localhost.</p> <p><a href="http://lh4.ggpht.com/-sMrzf9BRk1s/UKMcdH-wbTI/AAAAAAAABfI/8ftKwvYbjs4/s1600-h/image%25255B8%25255D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/-grghe8p9c7I/UKMceHoxLoI/AAAAAAAABfQ/eA11NCgG-D0/image_thumb%25255B4%25255D.png?imgmax=800" width="603" height="381"></a></p> <p>Verify by opening your browser and loading <a href="http://localhost:9000">http://localhost:9000</a></p> <p>You should see a welcome page.</p> <h3></h3> <h3>Step 3 : INTEGRATING SCALATE INT YOUR APPLICATION</h3> <p>I found the proper instructions to do this <a href="http://aftnn.org/2012/oct/01/play-20-and-scalate/">here</a>. But I will repeat them again.</p> <p>Go to helloworld-scalate\project\Build.scala</p> <h4>3.a Add the following lines to <strong>appDependencies</strong>. </h4><pre class="scala" name="code">"org.fusesource.scalate" % "scalate-core" % "1.5.3"</pre><br /><p><strong>What did we do? </strong>What we are doing is to add a dependency on scalate-core in an SBT friendly style. Play 2.0 takes care of fetching this dependency through its repositories which is listed at helloworld-scalate\project\plugins.sbt</p><br /><p>To verify if things are fine, go back to command line and run the command </p><br /><p><strong>play run</strong></p><br /><p>You should see that SBT updates the dependencies. Just verify if your application can still be browsed from localhost:9000.</p><br /><h3></h3><br /><h4>3.b Add ScalaIntegration.scala to helloworld-scalate\app\lib</h4><br /><p>You will need to create a folder “lib” inside helloworld-scalate\app folder. And then from the URL given below copy the content into a new file – ScalaIntegration.scala</p><br /><p><a title="https://raw.github.com/janhelwich/Play-2-with-Scala-and-Scalate/master/app/controllers/ScalateIntegration.scala" href="https://raw.github.com/janhelwich/Play-2-with-Scala-and-Scalate/master/app/controllers/ScalateIntegration.scala">https://raw.github.com/janhelwich/Play-2-with-Scala-and-Scalate/master/app/controllers/ScalateIntegration.scala</a></p><br /><p>This does the necessary bootstrapping such that you can now use scalate in the current project.</p><br /><p>Run the “play run” command again and reload the page at localhost:9000 to make sure you haven’t made a mistake.</p><br /><h2></h2><br /><h3>Step 4 : UPDATE VIEWS &amp; ACTION WITH TEMPLATE OF YOUR CHOICE</h3><br /><p>Scalate supports multiple template engines like Jade, Mustache, Scaml. The documentation indicates that Scaml gives the best performance given the strongly typed nature. But I might have misread the docs so <a href="http://scalate.fusesource.org/which.html">read and check yourself</a>.</p><br /><p>To do this, rename your files inside “helloworld-scalate\app\views” folder such that extension is changed from <strong>.scala.html</strong> to <strong>.scaml.</strong> Note that you will see two files – the layout file (main) and the view file (index).</p><br /><p>In the main.scaml, add the following code.</p><pre class="scala" name="code">-@ var body: String<br />-@ var title: String = "Page"<br /><br />%html<br />  %head<br />    %title= title<br />  %body<br />    != body<br /></pre><br /><p>In the index.scaml, add the following code. </p><pre class="scala" name="code">-@ var message: String = "Page"<br />/Layout template file given here<br />-attributes("layout") = "main.scaml"<br /><br />%h1= message<br /></pre><br /><p>Notice that in the index.scaml, we specified that we want to apply the <strong>main.scaml</strong> layout using the <strong>attributes(“layout”) </strong>declaration.</p><br /><p>You also need to change the application controller which is inside the helloworld-scala\app\controllers\application.scala</p><br /><p>The Application controller has an action called “index” which is the one that gets executed when you were loading the browser. We need to change this action such that it renders using Scalate instead of the default one.</p><pre class="scala" name="code">package controllers<br /><br />import play.api._<br />import play.api.mvc._<br /><br />object Application extends Controller {<br /><br />  def index = Action {<br />    //Ok(views.html.index("Your new application is ready."))<br />    Ok(Scalate("index.scaml").render(‘message -&gt; "Hello World"))<br />  }<br />}<br /></pre><br /><p>As you can see in the index action, I commented the existing line added this one line.</p><br /><p><strong>Ok(Scalate("index.scaml").render(‘message-&gt; "Hello World")) </strong></p><br /><p>Please pay attention to the ‘<strong> </strong>in front of the title. Here the <strong><u>‘message</u></strong> is a symbol literal. <a href="http://daily-scala.blogspot.com/2010/01/symbols.html">You can read more about them here.</a>&nbsp; </p><br /><p>Now run the “play run” command again and you should see plain html page that prints “Hello World”.</p><br /><p>I hope this step-by-step helped you get started with a new play 2.0 web application in Scala and also made you familiar with integrating the scalate engine. Note that the <a href="http://aftnn.org/2012/oct/01/play-20-and-scalate/">original url</a><strong>&nbsp;</strong>which I mentioned earlier has the same steps but step 4 where default Scalate template type is specified in the &lt;application folder&gt;\conf\application.conf<strong> </strong>is not performed. I skipped this step and it doesn’t appear that it will cause any problems. But again, after reading this tutorial, if you are a beginner, then you and I are at the same level so please feel free to explore more and learn. </p><br /><p>Thanks!</p>  


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2012-11-06">06 Nov 2012</time> </span>
            <h2 class="post-title"><a href="/2012/11/06/Useless-experiment-with-Asynchronous-Procedure-Calls-from-C%23.html">Useless experiment with Asynchronous Procedure Calls from C#</a></h2>

        </header>
        <section class="post-excerpt">
            <p>While Hurricane Sandy hit the East Coast and gave me a full week of vacation without electricity and internet, I gathered enough motivation to read through the very good book – concurrent programming on Windows by Joe Duffy. So here, I came across the Asynchronous Procedure Calls and what they mean. So this post is just a journal about me trying to do something clever (actually stupid) and sharing my madness with others.</p> <p>From what I learnt, an asynchronous procedure call (APC) is just a procedure that you can queue and request the OS that this procedure be performed on a particular thread. But that particular thread may be executing something right? So the question is when will the APC be executed? The answer for that is “it will be executed on the thread when it enters an ‘alertable wait’ state”. So what is an alertable wait?</p> <p>Consider the code below.</p><pre class="csharp" name="code">void IExecuteOnAThread(){<br />	lock(syncLock){<br />		while(conditionIsNotMet)<br />			Monitor.Wait(syncLock);<br />	}<br />}<br /></pre><br /><p>In the above snippet, the thread is actually waiting on the <strong>syncLock</strong>. When some other thread that makes the conditionIsNotMet as false and does a Pulse() on the syncLock, this current thread shall wake up and proceed with its execution. </p><br /><p>Now back to “alertable wait” –&gt; If a thread enters an alertable wait, then it can wake up properly (like in the case above) or can wake up for some other reason. This is how APC gets executed. When an APC gets queued on a thread, the OS will execute this APC the moment it finds that thread in an “alertable wait”.</p><br /><p>So while I think about this concept, it stuck to me (given that I am not that smart) to run a simple experiment. Usually, we queue work items into ThreadPool to get executed. Now the execution can happen in parallel so there is no order guarantee. In some cases, I would like to execute some asynchronous operations “in-order”; as queued; in the background (for whatever reason). In these cases, we typically use some kind of “executor” classes where a queue is almost always involved and some thread/threads wait for the work to be queued and execute them one by one – classic Producer/Consumer style. </p><br /><p>So what I wanted to try was to take advantage of APC and get away from not having to write any code to implement executors. </p><br /><ul><br /><li>I would simply create an “Executor” which has one thread which is always in an alertable wait state (Note that CLR takes care of making sure the Waits are resumed properly in case of any spurious wake-ups) <br /><li>The OS will take care of executing my operations one-by-one.</li></ul><br /><p>Note: For those who cannot wait till the end, do not do this – it is not worth it. I am just doing it because Sandy hit my head pretty hard.</p><pre class="csharp" name="code"> public class StupidExecutor<br />    {<br />        delegate void ApcProc(UIntPtr dwParam);<br /><br />        [DllImport("kernel32.dll")]<br />        static extern uint QueueUserAPC(ApcProc pfnApc, IntPtr hThread, UIntPtr dwData);<br /><br />        [DllImport("kernel32.dll")]<br />        static extern IntPtr GetCurrentThread();<br /><br />        private readonly AutoResetEvent _waiter = new AutoResetEvent(false);<br />        private IntPtr _threadId = IntPtr.Zero;<br /><br />        public StupidExecutor()<br />        {<br />            new Thread(WaitForApc).Start(null);<br />        }<br /><br />        public void Stop()<br />        {<br />            _waiter.WaitOne();<br />        }<br /><br />        private void WaitForApc(object none)<br />        {<br />            _threadId = GetCurrentThread();<br />            _waiter.WaitOne();<br />        }<br /><br />        public void QueueWork(Action action)<br />        {<br />            //while (Thread.VolatileRead(ref _threadId) == IntPtr.Zero)<br />            //    Thread.Sleep(0);<br />            var localAction = action;<br />            ApcProc apcProc = ((z) =&gt; localAction());<br />            QueueUserAPC(apcProc, _threadId, UIntPtr.Zero);<br />        }<br />    }</pre><br /><p>When the StupidExecutor gets created, a thread is launched which when started waits for a signal on a Auto Reset Event. This will make the thread wait because it is non-signalled and will remain so until Stop is executed on the executor. The executor has one method “QueueWork” which takes a delegate.</p><br /><p>So the usage of the stupid executor is as shown:</p><pre class="csharp" name="code">static void Main(string[] args)<br />        {<br />            var executor = new StupidExecutor();<br />            double[] avg = {0.0};<br />            int size = 1000;<br />            for (int j = 0; j &lt; size; j++)<br />            {<br />                var queued = DateTime.UtcNow;<br />                executor.QueueWork(() =&gt; avg[0] += (DateTime.UtcNow - queued).TotalMilliseconds);<br />            }<br />            Console.ReadLine();<br />            Console.WriteLine("Average Latency : "+avg[0]/size);<br />        }<br /></pre><br /><p>So the intention was to measure the latency (again not really the most efficient way). And I see an average latency of around 2 ms. So this must be a great way! Not really! First of all, for a <a href="http://www.bluebytesoftware.com/blog/2006/05/04/UsermodeAPCsAndManagedCode.aspx">lot of reasons like state corruption among other things</a> this should not be done. Moreover, you are passing managed delegates to native code. So GC can always kick in. So to prove it, I am changing the sample size from 1000 to 100000.</p><br /><p>Firstly, it wouldn’t work and you will be greeted with a nice dialog.</p><br /><p><a href="http://lh4.ggpht.com/-15Xbi2Ct0Hg/UJiAQsJJseI/AAAAAAAABeA/MhNxGx0dOmg/s1600-h/image%25255B7%25255D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/-6vrQN11_V8I/UJiARJpXtGI/AAAAAAAABeI/OIdKDCXsqEg/image_thumb%25255B3%25255D.png?imgmax=800" width="344" height="205"></a></p><br /><p>So run it in debug mode and you will get a nice little MDA called “CallbackOnCollectedDelegate" shall be raised. This simply says that the delegate you passed to native code is GC’d already. </p><br /><p><a href="http://lh5.ggpht.com/-XKd7PqYRRFU/UJiARiXmKpI/AAAAAAAABeQ/IJD3nDmuAK4/s1600-h/image%25255B11%25255D.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/-FmREQ-ejXXk/UJiASHQCyTI/AAAAAAAABeU/vu9B1HxccDw/image_thumb%25255B4%25255D.png?imgmax=800" width="344" height="154"></a></p><br /><p>Or even this:</p><br /><p><a href="http://lh4.ggpht.com/-zu5wHmzhKrA/UJiASk7JXcI/AAAAAAAABeg/wSnfqah7VhA/s1600-h/image%25255B15%25255D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/-7fMASb9OyOA/UJiATS5yXII/AAAAAAAABeo/-hoNLcpfNKE/image_thumb%25255B6%25255D.png?imgmax=800" width="350" height="177"></a></p><br /><p>So the experiment which was doomed to fail did fail. Long story short – don’t mess with your threads.</p>  


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2012-10-29">29 Oct 2012</time> </span>
            <h2 class="post-title"><a href="/2012/10/29/A-5-min-survey.html">A 5 min survey</a></h2>

        </header>
        <section class="post-excerpt">
            Those who are unfortunate to see this post, can you please take <a href="http://www.surveymonkey.com/s/5ZMQ9NZ">this quick survey</a> (7 questions) 


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2011-12-13">13 Dec 2011</time> </span>
            <h2 class="post-title"><a href="/2011/12/13/Working-%28around%29-with-MSpecs.html">Working (around) with MSpecs</a></h2>

        </header>
        <section class="post-excerpt">
            I just started playing with <a href="https://github.com/machine/machine.specifications" target="_blank">Machine.Specifications</a> (MSpecs). Overall I am very satisfied with the project but I did ran across some issues - dont get me wrong, it works great but it was more like limitations because I was lame and using Express edition.<br />My specs are simple - I am trying to create a Dependency Injection Container that does absolutely very little, not as powerful as Unity or any other containers. I dont plan to use it anywhere - just am trying to create one for fun. So the specifications are simple (for now).<br /><pre class="xml" name="code"> <br />Mapping Interface to Type, MappingInterfaceToType<br />  » should allow creating instance of type registered<br />  <br />  In case of multiple constructors, pick the one with injection attribute, MultipleConstructorScenario<br />  » should create instance whose Value property is 20<br />  <br />  Container should support singleton instances, SingletonScenario<br />  » should return the same instance for every invocation<br />  <br />  Inner container should be supported, SupportForInnerContainer<br />  » should return registration from parent and itself</pre><br /><br />Simple right? Those are the output for my specifications. It it still under works but the output itself explains a lot - thats the power of the MSpecs. Business Analysts write requirements, gives specifications - This can be changed - they give us the requirements and we "program" the specifications. I know it appears to be some rewired Unit Testing, but if unit tests can give me a bunch of specifications and tell me what failed, I would be more than happy to use that. <br /><br /><br />Now lets write a specification from scratch. Look at the following simple C# code. <br /><pre class="csharp" name="code"> public class Singleton { }<br />        public class Transient<br />        {<br />            public Singleton SingletonInstance { get; private set; }<br />            public Transient(Singleton ins)<br />            {<br />                SingletonInstance = ins;<br />            }<br />        }</pre><br />I would like to register the Singleton class as - singleton and the transient class as - transient. So my specification is, <strong>instances of transient whose dependency is a singleton should get the same instance. </strong>So that becomes my "Subject" <br /><br /><br /><pre class="csharp" name="code">[Subject("instances of transient whose dependency is a singleton should get the same instance.")]<br />public class InjectionOfSingletonForTransientResolution<br />{<br />}</pre><br />Now to verify that specification, I need to <strong>"establish a context"</strong> which is that I need my container to be ready for use.<br /><pre class="csharp" name="code"> Establish context = () =&gt;<br /> {<br />            _builder = new TypeBuilder();<br /> };</pre><br />Now that context is established, I will just write my specification. I create two instances and both my instances should have the same instance of Singleton. <br /><pre class="csharp" name="code"><br />It Should_Use_The_Same_Instance_when_creating_dependent_Components = () =><br />{<br />            var instance1 = _builder.Resolve<transient>();<br />            var instance2 = _builder.Resolve<transient>();<br />            instance1.ShouldNotEqual(instance2);<br />            instance1.SingletonInstance.ShouldNotBeNull();<br />            instance2.SingletonInstance.ShouldNotBeNull();<br />            instance1.SingletonInstance.ShouldEqual(instance2.SingletonInstance);<br />};<br /></pre><br />But you know this would not happen just like that. I have my context and I know what it should do. I need to tell it why it should do that - that specification would pass <strong>"because I am registering dependency as singleton and instance as transient".</strong> So I add my reasons on why (or when) the specification would pass.<br /><pre class="csharp" name="code"><br />Because I_Am_Making_A_Dependency_Registration_As_Singleton_And_TestSubject_As_Transient = () =><br />{<br />            _builder.Register<singleton>(new Singleton());<br />            _builder.Register<transient>();<br />};<br /></pre><br />The whole specification would look like shown below. <br /><pre class="csharp" name="code">[Subject("instances of transient whose dependency is a singleton should get the same instance.")]<br />    public class InjectionOfSingletonForTransientResolution<br />    {<br />        static ITypeBuilder _builder;<br /><br />        public class Singleton { }<br />        public class Transient<br />        {<br />            public Singleton SingletonInstance { get; private set; }<br />            public Transient(Singleton ins)<br />            {<br />                SingletonInstance = ins;<br />            }<br />        }<br /><br />        Establish context = () =><br />        {<br />            _builder = new TypeBuilder();<br />        };<br /><br />        Because I_Am_Making_A_Dependency_Registration_As_Singleton_And_TestSubject_As_Transient = <br />        () =><br />        {<br />            _builder.Register<singleton>(new Singleton());<br />            _builder.Register<transient>();<br />        };<br /><br />        It Should_Use_The_Same_Instance_when_creating_dependent_Components = () =><br />        {<br />            var instance1 = _builder.Resolve<transient>();<br />            var instance2 = _builder.Resolve<transient>();<br />            instance1.ShouldNotEqual(instance2);<br />            instance1.SingletonInstance.ShouldNotBeNull();<br />            instance2.SingletonInstance.ShouldNotBeNull();<br />            instance1.SingletonInstance.ShouldEqual(instance2.SingletonInstance);<br />        };<br />    }<br /></pre><br />When I first run this my specification failed because my container does not handle that yet. <br /><pre class="xml" name="code"> instances of transient whose dependency is a singleton should get the same instance., InjectionOfSingletonForTransientResolution<br />  » Should Use The Same Instance when creating dependent Components (FAIL)<br />  Machine.Specifications.SpecificationException: Should be [not null] but is [null]<br />     at Machine.Specifications.ShouldExtensionMethods.ShouldNotBeNull(Object anObject) in d:\BuildAgent-03\work\38fe83de684fd902\Source\Machine.Specifications\ExtensionMethods.cs:line 181<br />     at Analytics.Specifications.Container.InjectionOfSingletonForTransientResolution.&lt;.ctor&gt;b__2() in C:\Users\bhargav\documents\visual studio 2010\Projects\Analytics\Analytics.Specifications\Container\TypeBuilderSpecs.cs:line 159<br />     at Machine.Specifications.Model.Specification.InvokeSpecificationField() in d:\BuildAgent-03\work\38fe83de684fd902\Source\Machine.Specifications\Model\Specification.cs:line 75<br />     at Machine.Specifications.Model.Specification.Verify() in d:\BuildAgent-03\work\38fe83de684fd902\Source\Machine.Specifications\Model\Specification.cs:line 53</pre><br />I fix my container and now I see my specification pass.<br /><br />One thing to remember is what ever you are working off - your context - it should be static - otherwise the compilation would fail. when looking at others examples, I had a similar question - so here I am telling you upfront.<br /><br /><h3>Running specifications without leaving Visual Studio - No test runners are required.</h3><br />All my specifications are in a separate class library. I would like to run the specifications without leaving Visual Studio (btw, I am using Express). I remember once upon a time I could make a class library as a startup project and somehow linked NUnit gui runner with the project. I could not get it done with VC# 2010 Express anymore. May be I am missing something. Anyway the solution was to add the following Post-Build event<br /><br /><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/TTJ6ruuy-ZI/AAAAAAAABbY/4OD3cJB2Sns/s1600-h/image%5B3%5D.png"><img alt="image" border="0" height="277" src="http://lh5.ggpht.com/_Oy9HuksgrdU/TTJ6sZXdyjI/AAAAAAAABbc/PhFKCTD1BB0/image_thumb%5B1%5D.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="644" /></a><br /><br />Once my specifications project it built successfully, it automatically generates a nice output. You can use all command line arguments that mspec supports, for now I only care if they pass or fail, hence the simple one.<br /><br /><h3>Debugging my specifications. It was painful</h3><br />I tried all different strategies like using System.Diagnostics.Debugger.Break() and what not. ConsoleRunner that comes with mspec (mspec.exe) was crashing complaining that it encountered an user defined breakpoint in the code - yeah that was my intention. Anyway to work around that, I create a console program and in the console application, I added reference to my specifications library and from the Git Hub source code for the mspec.exe (thanks to OSS) the following C# code helped me overcome my limitation of not being able to use R# or TestDriven.Net.<br /><pre class="csharp" name="code"> class ContainerSpecsRunner<br />    {<br />        static void Main(string[] args)<br />        {<br />            //Console.WriteLine(typeof(ITest).Assembly.Location);<br />            Program prog = new Program(new DefaultConsole());<br />            prog.Run(new[] { typeof(ITest).Assembly.Location });<br />        }<br />    }</pre><br />ITest is a type that was defined in my specifications assembly. That way I need not worry about any arguments or hardcode path of my assembly. By the way, at work you might be killed for doing this, I am just doing it at my personal projects.<br /><br /><h3>Some samples? </h3><br />Ok the biggest problem I had was that I could not find some real world examples, the GIT HUB structure of the project was confusing as hell. I was hoping to find some examples, but I could not. As much as I like the project, I hate to see so little or almost non-existent guidance for new users. So here are some of my specifications. These are written by me - I am just learning the style of specs so forgive me if they are not what you wanted them to be. I am just trying to help. <br /><pre class="csharp" name="code">public interface ITest{<br />    }<br /><br />    public class Test: ITest{<br />        [Injector]<br />        public Test()<br />        {<br /><br />        }<br />    }<br /><br />    [Subject("Mapping Interface to Type")]<br />    public class MappingInterfaceToType<br />    {<br />        static ITypeBuilder _builder;<br /><br />        Establish context = () =&gt;<br />        {<br />            _builder = new TypeBuilder();<br />        };<br /><br />        Because of = () =&gt;<br />        {<br />            _builder.Register<itest ,="" test="">();<br />        };<br /><br />        It should_allow_creating_instance_of_type_registered = () =&gt;<br />        {<br />            var resolvedObject = _builder.Resolve<itest>();<br />            resolvedObject.ShouldNotBeNull();<br />            typeof(Test).ShouldEqual(resolvedObject.GetType()); <br />        };<br />    }<br /><br />    [Subject("In case of multiple constructors, pick the one with injection attribute")]<br />    public class MultipleConstructorScenario<br />    {<br />        public class Test2 : ITest<br />        {<br />            public int Value { get; private set; }<br />            public Test2(ITest demo)<br />            {<br />                Value = 10;<br />            }<br /><br />            [Injector]<br />            public Test2()<br />            {<br />                Value = 20;<br />            }<br />        }<br /><br />        static ITypeBuilder _builder;<br />        Establish context = () => {<br />            _builder = new TypeBuilder();<br />        };<br /><br />        Because of = () =><br />        {<br />            _builder.Register<ITest,Test2>();<br />        };<br /><br />        It should_create_instance_whose_Value_property_is_20 = ()=><br />{<br />            var instance = _builder.Resolve<ITest>();<br />            instance.ShouldBeOfType<Test2>();<br />            (instance as Test2).Value.ShouldEqual(20);<br />        };<br />    }<br /><br />    [Subject("Container should support singleton instances")]<br />    public class SingletonScenario<br />    {<br />        static ITypeBuilder _builder;<br /><br />        Establish context = () =><br />        {<br />            _builder = new TypeBuilder();<br />        };<br /><br />        Because instance_Is_Registered = () =><br />        {<br />            _builder.Register<ITest>(()=>new Test());<br />        };<br /><br />        It should_return_the_same_instance_for_every_invocation = () =><br />        {<br />            _builder.Resolve<ITest>().ShouldEqual(_builder.Resolve<ITest>());<br />        };<br />    }<br /><br />    [Subject("Inner container should be supported")]<br />    public class SupportForInnerContainer<br />    {<br />        static ITypeBuilder _builder;<br />        static ITypeBuilder _child;<br />        Establish context = () =><br />        {<br />            _builder = new TypeBuilder();<br />            _child = _builder.CreateChildBuilder();<br />        };<br /><br />        Because instance_is_registered_with_child_container = () =><br />        {<br />            _builder.Register<IEnumerable>(new int[] { 0, 1, 2 });<br />            _child.Register<ITest,Test2>();<br />        };<br /><br />        It should_return_registration_from_parent_and_itself = () =><br />        {<br />            var arr = (int[])_child.Resolve<IEnumerable>();<br />            arr.SequenceEqual(new[] { 0, 1, 2 }).ShouldBeTrue();<br />            _child.Resolve<ITest>().ShouldBeOfType<Test>();<br />        };<br />    }<br /></pre><br /><br /><h3>Would be nice if it can print my "Because" field names</h3><br />Just like the console runner prints my "It" fields, it would be nicer if my reasons are printed. I will see if i can do that myself to the project and may contribute a little.<br /><br /><br />I hope the examples are useful. By no means they are perfect but they can get you started. You can see in the example I detailed in the beginning, I had a whole bunch of Should statements = that is plain wrong. Each specification should define one thing - otherwise it would be a big mess. Please look at this great project and I really am in love with MSpec.


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2011-12-13">13 Dec 2011</time> </span>
            <h2 class="post-title"><a href="/2011/12/13/Real-World-Example-%3A-Simple-PublishSubscribe-Pattern-with-Reactive-Extensions.html">Real World Example : Simple Publishsubscribe Pattern With Reactive Extensions</a></h2>

        </header>
        <section class="post-excerpt">
            <p>Shown below is a requirement. <br><script src="https://gist.github.com/1470033.js?file=EventThrottlingTest.cs"></script><br>Let me explain a little about what I want to achieve. I have an entity called “Frequent” which implements INotifyPropertyChanged interface. So I can subscribe to the change notification and then upon firing the event, I simply increment a counter. Now, my requirement is that the PropertyChanged can fire way too quickly as simulated in the for-loop. So in UI applications, it doesn’t make sense for me to fire property changed events that frequently as in a real world intensive WPF application, this can become your biggest bottleneck (among several others things). </p> <p>So my requirement is that, within 1 second, I would like to receive only 1 change notification per property, if it has changed indeed. The simple implementation for this would be to do something like pushing the properties that have changed into a queue and process the queue once a second and then raise change notification event. This can be done very easily but then it can be a little tedious job for such a requirement to restrict an event from firing more than X times a second. </p> <p>So I was looking at the Reactive Extensions (Rx Framework) and it occurred to me that it should support Observer pattern out of the box. So I started playing with it but hit a road block immediately. There are numerous resources that shows how to generate observables from Timers, Time Intervals, Enumerables, etc but what I want to is to take advantage of extension methods supported by Rx Framework on IObserver such as Throttle(), Buffer(), Window(), etc on a simple Pub-Sub system. May be I did not look hard enough but I could not find a simple example. So I thought it would be helpful for rest of the people like me if I made a blog post.</p> <p>In my implementation, the Frequent object is by itself a Publisher and a Subscriber. In Rx terms – IObservable and IObserver. Instead of implementing these interfaces, I want to have some observable of strings where I will publish a property that has changed and the subscriber on the observable would receive it. So for that purpose of simple message passing between Observers and Observables, you can use a Subject&lt;T&gt;. There are other variants like ReplaySubject&lt;T&gt;, BehaviorSubject&lt;T&gt;, AsyncSubject&lt;T&gt;, etc. but that is out of scope of this post. I publish on Subject&lt;T&gt; and then the subscribers who subscribed earlier to it would be notified of these messages.</p> <p>Shown below is a the Frequent class implementation.</p> <p><script src="https://gist.github.com/1470125.js?file=Frequent.cs"></script></p> <p>Take a minute or two to go through the simple class, it is self explanatory. All I am doing is that when a property changes, instead of firing it immediately, I simply notify my throttler about the property that has changed. The throttler’s responsibility is to determine when to notify the subscribers about this change. Shown below is the implementation.</p> <p><script src="https://gist.github.com/1470141.js?file=StringMessageThrottler.cs"></script></p> <p>You can read my comments that I wrote out of frustrations. All I do in this simple façade is to wrap an Observable –&gt; Subject&lt;string&gt; and buffer the messages received for 1/2 second and then get unique messages from the buffer and publish it to the subscribers. This is all done in the constructor. The other methods are simply my take on making things simple for the consumer of this class.</p> <p>Rx is complex and powerful but in my opinion it has a very steep learning curve. But it surely did save a good few days of implementation for my team. Again, I am very new to Rx, so if you have some better ways to do it, then please let me know.</p>  


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2011-12-10">10 Dec 2011</time> </span>
            <h2 class="post-title"><a href="/2011/12/10/Hannspad-Hannspree-SN10T2-%E2%80%93-Rooting%2C-Android-Market-and-Some-Crazy-stuff.html">Hannspad Hannspree SN10T2 – Rooting, Android Market and Some Crazy stuff</a></h2>

        </header>
        <section class="post-excerpt">
            <p>Recently the Android Tablet bug bit me which led me to buy Hannspad Hannspree SN10T2 from AliExpress.com. The order was made on the day of Thanksgiving and I received the tablet within two weeks. The whole goal was to get a cheap tablet on which I can try installing custom ROM, may be try and develop some applications. But turns out it is not that simple. See the Slatedriod.com forums has custom ROM but for SN10T1 model but not SN10T2 model – which runs on two different processors. So all the cool stuff I read about that people do with SN10T1 is not applicable for SN10T2 – example being booting the tablet in recovery mode. There are not hard volume buttons that lets me boot into recovery console. I tried all different combinations instead of missing Volume + button but the recovery key sequence remains unknown.</p> <h2></h2> <h2>Connecting the Hannspad Tablet to Windows 7 x64</h2> <p>Hooking up the USB cable to the Windows 7 machine doesn’t really install the drivers. You can still be able to copy files around once you enable the USB File Transfer on the tablet. If you are new like me, just drag the notifications bar on top of the tablet and the instructions then are clear enough for you to know what to do. So first time you hook up the tablet, you get the message saying OMAP-3/4 driver is not found. Don’t even fight it, there is a really simple way to install the driver for the tablet.</p> <ol> <li>Download Super One Click from Shortfuse.org. The direct link to what I am using is <a href="http://www.multiupload.com/VGCN3ZTFM8" target="_blank">here.</a> It is version 2.3.1.</li> <li>Extract the zip file to some place you have your portable applications. I put it in temp but now I have a problem deleting the folder because driver was installed from this location??</li> <li>Launch SuperOneClick.exe and then click on Advanced Tab.</li> <li>Click on Check Driver.</li> <li>Then say OK for installation of the driver.</li> <li>Accept Windows warning about unsigned driver and move on.</li></ol> <p>What this driver lets you do is to let ADB (Android Debug Bridge or visualize like a remote shell access for your tablet unix system) identify that this device is hooked up and running.</p> <h3></h3> <h3></h3> <h3></h3> <h2>Rooting the SN10T2 (may work for other tablets too!)</h2> <p>If you search for information on how to root the SN10T2, the first thing you see is the article by <a href="http://tabletrepublic.com/forum/hannspad/hannspad-sn10t2-easy-rooting-google-apps-guide-143.html" target="_blank">Sir Shagsalot</a> (<img style="border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none" class="wlEmoticon wlEmoticon-winkingsmile" alt="Winking smile" src="http://lh6.ggpht.com/-FCWo0OcWuXg/TuLXM444_NI/AAAAAAAABcs/RhwNRvmp0GY/wlEmoticon-winkingsmile%25255B2%25255D.png?imgmax=800">). It has precisely what you need to do in order to enable Super User access for the programs running on your Android Tablet. Since the information is not so eye-soothing, I will try to replicate the information. But be aware </p> <ol> <li>The information here is from the article I mentioned above plus my experience struggling with the Tablet.</li> <li>I am not an Android Expert – I am just a software developer who writes software for a living mostly on Windows Platform.</li> <li>Don’t blame me for any physical or mental or financial pain that may cause as a result of following this information.</li> <li>Rooting implies the warranty is void. You cannot bitch about your tablet to your vendor anymore. Not my problem again <img style="border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none" class="wlEmoticon wlEmoticon-smile" alt="Smile" src="http://lh5.ggpht.com/-B3_Y66zUzlE/TuLXNMkqz9I/AAAAAAAABc0/46RWP-R0B5o/wlEmoticon-smile%25255B2%25255D.png?imgmax=800"></li></ol> <h3></h3> <h3></h3> <h3>Option 1 : Using the same SuperOneClick</h3> <p>If you followed the previous steps, you can use SuperOneClick to Root your device. </p> <h3>Option 2 : Using <a href="http://forum.xda-developers.com/showthread.php?t=833953" target="_blank">z4Root</a>&nbsp;</h3> <ol> <li>Download the z4root.apk and place it in your SD Card on the tablet.</li> <li>On the tablet, go to Menu-&gt;Settings-&gt;Application Settings and check the option for Unknown Sources.</li> <li>Now go to Home-&gt;Applications-&gt;ES File Explorer.</li> <li>Navigate to the z4root.apk wherever you copied it.</li> <li>Install the APK file.</li> <li>Then open the z4root application.</li> <li>You will see two options –&gt; Temporary Root or Permanent Root. If your application is already rooted, you will see the option to Unroot.</li> <li>I selected Permanent Root.</li> <li>Then wait until you see “Rebooting..”. If the tablet doesn’t reboot in say 10 minutes, I would not bother to wait. Just restart the tablet manually. It is fine!</li></ol> <h3></h3> <h3>The Android SDK Tools</h3> <p>Basically, rooting gives you Super user access and lets you access the shell from ADB console. The super one click application distributes the ADB console application if you poke inside the installation folder. </p> <p>Anyway for you to officially get the ADB application, you can download the Android SDK from <a href="http://developer.android.com/sdk/index.html" target="_blank">here.</a>&nbsp;</p> <ol> <li>Download the <a href="http://developer.android.com/sdk/index.html" target="_blank">Android SDK.</a></li> <li>Download the <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank">Java Development Kit</a>, if you don’t have it already. You need JDK not JRE.</li> <li>Install JDK. Install Android SDK.</li> <li>Now in the Android folder (C:\Program Files(x86)\Android\android_sdk\), launch the SDK Manager application. See image below.</li> <li>You need to check “Android SDK Tools” and then click “Install Packages”.</li> <li>Once done, you will find a folder called “platform-tools”.</li></ol> <p><a href="http://lh4.ggpht.com/-juGMnplne4M/TuLXNYHUJ8I/AAAAAAAABc8/O7t83ulPnLw/s1600-h/image%25255B3%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/-8YQOmn5pJFQ/TuLXNr8DPBI/AAAAAAAABdE/uFnJXm6yX94/image_thumb%25255B1%25255D.png?imgmax=800" width="352" height="253"></a></p> <h3></h3> <h3>Some fun with ADB.</h3> <ul> <li>Open command prompt and assuming platform-tools is in your PATH. <strong> <h3><strong>(Of course, the table is connected to the machine, USB Debugging enabled on the tablet).</strong></h3></strong></li> <li>Listing all the devices – <strong>adb devices</strong></li> <li>Opening the Unix Shell for your tablet – <strong>adb shell</strong></li> <li>Copying files from your PC to the device</li> <ul> <li>For SD Card, you don’t need to mount as it is already mounted for “Read-Write”. Just run the command - </li> <ul> <li><strong>adb push c:\myfiles\superdocument.pdf /sdcard/</strong></li></ul> <li>For copying to /system/app folder, which you may have to do for manual installation of Google Apps and Market</li> <ul> <li>Go to the shell of tablet using “adb shell”. Now inside the shell,</li> <li>Mount the /system using the command</li> <ul> <li><strong>mount -o remount,rw /dev/block/mmcblk0p5 /system</strong></li></ul> <li>Copy the files you want to push to /system/app, using</li> <ul> <li><strong>push c:\files\superapp.apk /system/app/</strong></li></ul> <li>Unmount the /system using the command</li> <ul> <li><strong>mount -o remount,ro /dev/block/mmcblk0p5 /system</strong></li></ul> <li>Make sure you unmount once you are done.</li></ul></ul> <li>Reboot the tablet from Windows – <strong>adb reboot</strong></li> <li>Copying files from your tablet to the PC – <strong>adb pull \sdcard\super.pdf c:\temp\goodbook.pdf</strong></li></ul> <h3></h3> <h3>Installing the Android Market on the SN10T2</h3> <p>You can follow the original instructions from top to bottom <a href="http://tabletrepublic.com/forum/hannspad/hannspad-sn10t2-easy-rooting-google-apps-guide-143.html" target="_blank">that Sir ShagsALot wrote here.</a> I will just use the ADB to install the Android Market application.</p> <ul> <li>Root your tablet either using SuperOneClick or Z4Root as described previously. Reboot your tablet.</li> <li>Download the required Google Apps distribution from the link mentioned in the article.</li> <li>Extract them to some place on your machine.</li> <li>Make sure ADB is in your PATH. Open the Command Prompt and navigate to the folder where you extracted the googleapps.rar archive.</li> <li>You should see something like shown below.</li></ul> <p align="center"><a href="http://lh6.ggpht.com/--K5PbEsjGPE/TuLXNyxwHjI/AAAAAAAABdM/OvNG4Unppdk/s1600-h/image%25255B7%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/-n8nlnzr5QDw/TuLXOQTTgUI/AAAAAAAABdU/v1sQYmVsMgg/image_thumb%25255B3%25255D.png?imgmax=800" width="442" height="150"></a></p> <ul> <li>Navigate the command prompt into the “app” folder.</li> <li>Using the ADB shell, first mount the /system on your tablet. Then run the following commands to push APK files to /system/root/</li> <ul> <li><strong>c:\temp\Working Google Apps\app&gt; adb push GoogleServicesFramework.apk /system/app</strong></li> <li><strong>c:\temp\Working Google Apps\app&gt; adb push OneTimeInitializer.apk /system/app</strong></li> <li><strong>c:\temp\Working Google Apps\app&gt; adb push SetupWizard.apk /system/app</strong></li> <li><strong>c:\temp\Working Google Apps\app&gt; adb push com.android.vending.apk /system/app/Vending.apk </strong></li> <li><em>Notice the Application for Market is renamed to Vending.apk (don’t think you need to do this, but everyone else uses Vending.apk) <img style="border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none" class="wlEmoticon wlEmoticon-smile" alt="Smile" src="http://lh5.ggpht.com/-B3_Y66zUzlE/TuLXNMkqz9I/AAAAAAAABc0/46RWP-R0B5o/wlEmoticon-smile%25255B2%25255D.png?imgmax=800"></em></li> <li><em>Shown below is the command prompt snapshot for your reference</em></li></ul></ul> <p><a href="http://lh3.ggpht.com/-3ksg9WUaeKg/TuLXOjX6YqI/AAAAAAAABdc/XXfFRrvnt98/s1600-h/image%25255B17%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/-qTY5DsnRFOU/TuLXO3TXWSI/AAAAAAAABdk/CY8aBakyORg/image_thumb%25255B7%25255D.png?imgmax=800" width="649" height="376"></a></p> <ul> <li>From the above you should have understand by now that I am only interested in making the Android Market work. </li> <li><strong>Don’t forget to un-mount the /system and also reboot the device as soon as you are done copying.</strong></li> <li>Once the tablet boots, you will be seeing a welcome screen.</li> <li>Just go through the welcome screen and add your google account.</li> <li>Now go to Market and make sure it runs.</li></ul> <h4></h4> <h3>Some issues that I had </h3> <ul> <li>ES File Explorer –&gt; Menu –&gt; Settings –&gt; Root Options. Check the “Root Explorer” failed with message <strong>"sorry, test failed. This feature cannot run on your phone” </strong>message. So what is the alternative ? Use ADB, it might sound intimidating but it is just a simple Shell prompt. If you are messing around your tablet, most likely you are comfortable with the command prompt.</li> <li>There is a great tool called “File Expert”. It is one tool that impressed me a lot! It is similar to ES File Explorer but much better looking and much easier and intuitive to use. You can upload files from your PC without having to connect your tablet.</li> <ul> <li>Install File Expert. You can get it from the App Center that ships with the SN10T2 as well.</li> <li>Launch File Expert. Go to “Share my contents”.</li> <li>Just touch on the “Share via Web” option. Viola! </li> <li>Now you should see a brief message explaining how you can access your tablet SD Card from the Web Browser.</li></ul> <li>Uploading multiple files from File Expert Web UI. You cannot upload more than one file when you are in the root of the SD Card. But create one folder and then you would be able to upload multiple files simultaneously. </li> <li>MOUNT Options in File Expert does not work and can make you believe that it worked. So what is the alternative?? Use ADB.</li> <li>If you manually move some files to /system/app in File Expert of ES File Manager, you may believe it was successfully copied, but they aren’t really done. You don’t see an error that /system has to be mounted. </li> <li>If you are messing with different versions of Google Apps, the one in the link by Sir ShagsALot is the only one I found to be working. If you mess up, then remove the APK files from the /system/app manually. </li> <li>I copied bad APK files and was stuck with Emergency dial screen. So what I realized later was that SetupWizard was badly renamed. So I removed the APK files and copied them keeping the name intact.</li> <li>Again, if you are stuck with wizard screen and reboot doesn’t help, use ADB to delete the APK file.</li> <li>Android Market app is installed but launches and dies immediately. You need to make sure GoogleServicesFramework.apk is properly installed/copied into /system/app folder. When in doubt, repeat the process after taking some break.</li> <li>Android Market App launches but cannot download application. The application page seems to be stuck at “Starting download…”. This only happened when I installed incompatible version of Android App Market.</li></ul> <p>So these are all the things that I struggled with this week and I hope anyone like me who is new to Android Rooting may find this information helpful. By the way, don’t forget to check out <a href="http://www.slatedroid.com/" target="_blank">SlateDroid</a>. They are awesome!</p>  


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2011-01-16">16 Jan 2011</time> </span>
            <h2 class="post-title"><a href="/2011/01/16/WPF-Events-to-Command-redirection-using-System.Windows.Interactivity.html">WPF Events to Command redirection using System.Windows.Interactivity</a></h2>

        </header>
        <section class="post-excerpt">
            <p><a href="http://krishnabhargav.blogspot.com/2011/01/executing-routedcommand-in-code-behind.html" target="_blank">As mentioned previously</a>, I recently used System.Windows.Interactivity library to make a command respond to an event on WPF controls without using any code-behind. In this post, I would give a brief overview and show some code on how to do it. I will try and keep the post to the point and not write anything about hooking up events with code or anything like that. Usual disclaimer applies – I am not entirely familiar with the internals but I know how to make it work and why it works.</p> <p>So lets start with my simple requirement. I have a text box and as I enter I want to fire a command which processes the text and displays it on a textblock. Of course you can hook up both the controls to the same property in the ViewModel and with .NET 4.0 you can be sure that the getter will fire again when NotifyPropertyChanged is fired. But that is not the point here. </p> <p>My XAML would simply have a textbox and a textblock. On textbox.TextChanged event fired, I would like to execute a command in my view model. The XAML is shown below.</p><pre class="xml" name="code">&lt;UserControl x:Class="Buddi.Training.Advanced.Interactivity.EventToCommandDemo"<br />    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"<br />             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"<br />             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" <br />             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" <br />             xmlns:local="clr-namespace:Buddi.Training.Infra"<br />             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"&gt;<br />    &lt;Grid Background="Beige"&gt;<br />        &lt;Grid.RowDefinitions&gt;<br />            &lt;RowDefinition Height="100"/&gt;<br />            &lt;RowDefinition Height="100"/&gt;<br />        &lt;/Grid.RowDefinitions&gt;<br />        &lt;TextBox Text="{Binding SampleCommandParam,UpdateSourceTrigger=PropertyChanged}" Margin="20"&gt;<br />            &lt;i:Interaction.Triggers&gt;<br />                &lt;i:EventTrigger EventName="TextChanged"&gt;<br />                    &lt;local:EventToCommand Command="{Binding SampleCommand}"<br />                                      CommandParameter="{Binding SampleCommandParam}"/&gt;<br />                &lt;/i:EventTrigger&gt;<br />            &lt;/i:Interaction.Triggers&gt;<br />        &lt;/TextBox&gt;<br />        &lt;TextBlock Text="{Binding Message}" Grid.Row="1" Padding="30" FontFamily="Consolas" FontWeight="14"/&gt;<br />    &lt;/Grid&gt;<br />&lt;/UserControl&gt;<br /></pre><br /><br /><p> You need to see how I am hooking up the event to the command in viewmodel which is the DataContext of the View (UserControl to be precise). Lets disect what we have here - We add an event trigger to the TriggersCollection on the Grid using the Interactivity.Triggers attached properties. An event trigger comes with the System.Windows.Interactivity.dll assembly. So add a reference to that library using the "Add Reference" dialog. The Event Trigger then expects an action that can be anything that derives from the <a href="http://msdn.microsoft.com/en-us/library/ff726548(v=Expression.40).aspx" target="_blank">TriggerAction&lt;FrameworkElement&gt;</a> class. The TriggerAction<T> derived class should implement one method called "InvokeCommand(object parameter)". The implementation simply takes care of executing the command which are passed to the DependencyProperty we defined in the EventToCommand class. Note that TriggerAction<FrameworkElement> is a DependencyObject, thereby it allows you define Dependency Properties to take full advantage of the Binding, Styles, Animations and what not. So the trigger action is simple - (the following is a special implementation where I handle RoutedCommand different than the others, this is just my scenario and is typically bad - you are programming to the implementation which is not a good idea, but the plan here is to show how you can use the base.AssociatedObject).<br /><br /><pre name="code" class="csharp"><br />namespace Buddi.Training.Infra<br />{<br />    public class EventToCommand : TriggerAction&lt;FrameworkElement&gt;<br />    {<br />        public ICommand Command<br />        {<br />            get { return (ICommand)GetValue(CommandProperty); }<br />            set { SetValue(CommandProperty, value); }<br />        }<br /><br />        public static readonly DependencyProperty CommandProperty =<br />            DependencyProperty.Register(&quot;Command&quot;, typeof(ICommand), typeof(EventToCommand), new UIPropertyMetadata(null));<br /><br /><br /><br /><br />        public object CommandParameter<br />        {<br />            get { return (object)GetValue(CommandParameterProperty); }<br />            set { SetValue(CommandParameterProperty, value); }<br />        }<br /><br />        // Using a DependencyProperty as the backing store for CommandParameter.  This enables animation, styling, binding, etc...<br />        public static readonly DependencyProperty CommandParameterProperty =<br />            DependencyProperty.Register(&quot;CommandParameter&quot;, typeof(object), typeof(EventToCommand), new UIPropertyMetadata(null));<br /><br /><br /><br />        protected override void Invoke(object parameter)<br />        {<br />            if (Command == null) return;<br />            if (Command is RoutedCommand)<br />            {<br />                var rc = Command as RoutedCommand;<br />                if (rc.CanExecute(CommandParameter, base.AssociatedObject))<br />                {<br />                    rc.Execute(CommandParameter, base.AssociatedObject);<br />                }<br />            }<br />            else<br />            {<br />                if (Command.CanExecute(CommandParameter))<br />                    Command.Execute(CommandParameter);<br />            }<br />        }<br />    }<br />}<br /></pre><br /><br /><p>That's it! you can now program to the events using the commands that you already have. This lets you keep your code-behind clean and write more testable code than ever. I hope this is useful inspite of it not being the best of the articles. By the way, almost every MVVM framework out there provides an implementation of Event To Command action -eg : Caliburn, Cinch, you name it ... but not always it is possible for us to use a third party framework just for this one reason. In such cases, I thought it is good to know that you can acheive it just by using Microsoft's assembly.</p>  


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2011-01-14">14 Jan 2011</time> </span>
            <h2 class="post-title"><a href="/2011/01/14/Executing-RoutedCommand-in-Code-Behind.html">Executing RoutedCommand in Code-Behind</a></h2>

        </header>
        <section class="post-excerpt">
            <p>Recently I had this issue where we had a bunch of routed commands but those which were to be bound to an event instead of directly on a Button.Command. Anyway with all the event to command redirection (hint: use System.Windows.Interactivity EventTriggers and TriggerAction&lt;FrameworkElement&gt;), the requirement boiled down to executing a RoutedCommand in code behind.</p> <p>Consider the command had a base class which looks as shown below.</p><pre class="csharp" name="code">public abstract class CommandBase<br />    {<br />        public ICommand Command { get; private set; }<br />        public CommandBinding CommandBinding { get; private set; }<br />        public CommandBase()<br />        {<br />            Command = new RoutedCommand();<br />            CommandBinding = new CommandBinding(Command, HandlerExecute, HandlerCanExecute);<br />        }<br /><br />        private void HandlerExecute(object sender, ExecutedRoutedEventArgs args)<br />        {<br />            Execute(args.Parameter);<br />        }<br /><br />        private void HandlerCanExecute(object sender, CanExecuteRoutedEventArgs args)<br />        {<br />            args.CanExecute = CanExecute(args.Parameter);<br />        }<br /><br />        protected abstract void Execute(object parameter);<br /><br />        protected abstract bool CanExecute(object parameter);<br /><br />        public static void DoCommandBind(CommandBase command, FrameworkElement element)<br />        {<br />            element.CommandBindings.Add(command.CommandBinding);<br />        }<br />    }<br /></pre><br /><p> The base class simply provides everything that you need to make use of RoutedCommand. It wraps the command and its command binding whose execute and can execute handlers are redirected to the abstract methods. So the implementation would be as simple as the one shown below and you would have a full fledged RoutedCommand</p><br /><br /><pre name="code" class="csharp"><br />public class SampleCommand : CommandBase<br />    {<br />        protected override void Execute(object parameter)<br />        {<br />            MessageBox.Show(parameter.ToString());<br />        }<br /><br />        protected override bool CanExecute(object parameter)<br />        {<br />            return parameter != null;<br />        }<br />    }<br /></pre><br /><p>In the above command, I simply execute the command if there is a parameter sent and when executed display the parameter passed in a MessageBox. In order to use this command in XAML, the markup would be as simple as : </p><br /><pre name="code" class="xml"><br />&lt;Button Command="{Binding Sample.Command}" CommandParameter="This is from XAML" Content="From XAML" /&gt;<br /></pre><br /><p>But for the RoutedCommand to work, the CommandBinding associated with it should be added to one of the elements up in the Visual Tree. So one of the parents for the Button should have the CommandBinding for the command to be registered with them. This is performed using the CommandBase.DoCommandBind() method. This is required because - the RoutedCommand - even though it implements ICommand interface, the Execute() and CanExecute() methods simply trigger the events that result in the CommandBinding execute the handlers that were specified when the command binding was being created. Read on MSDN for a much better english explanation. If the command binding cannot be found on any of the ancestors, the command would never fire! This is important to understand when we later look at the C# way to execute a RoutedCommand. </p><br /><br /><p> For now, look at the code behind. It is simple and what happens in the constructor is self explanatory. </p><br /><br /><pre name="code" class="csharp"><br />        private CommandBase sample = new SampleCommand();<br />        <br />        public CommandBase Sample<br />        {<br />            get { return sample; }<br />        }<br /><br />        public CommandDemo()<br />        {<br />            InitializeComponent();<br />            this.DataContext = this;<br />	    //do a command binding on this UserControl itself.<br />            CommandBase.DoCommandBind(sample, this);<br />        }<br /></pre><br /><br /><h3>Gotcha 1 : RoutedCommand does not fire!</h3><br /><p>If this is the case, then make sure the CommandBinding for the RoutedCommand has been registered properly. You can do it in Code-Behind (like CommandBase.DoCommandBind() in my example) or in XAML (loads of examples online for that).</p><br /><br /><h3> How do I execute a RoutedCommand from code-behind? </h3><br /><p> Again, same rules apply. The command binding should be available to be found on the ancestors where the command will be fired. If that is the case, then you can do it in the following way.</p><br /><br /><pre name="code" class="csharp"><br />var rc = (sample.Command as RoutedCommand);<br />if (rc.CanExecute("This is command parameter", e.OriginalSource as Control))<br />   rc.Execute("This is command parameter", e.OriginalSource as Control);<br /></pre><br /><br /><P> Executing the ICommand.Execute(parameter) (eg: sample.Command.Execute("parameter")) would work, but if in any case it does not work, use the method above. </p><br /><h3>Gotcha 2 : RoutedCommand.CanExecute(parameter) does not fire when executing a RoutedCommand from code-behind!</h3><br /><p> Yes, ICommand.CanExecute() is just an interface method, its the job the command invoker (if done in code-behind, it is you who is the command invoker) to verify if the command can be executed using CanExecute(). </p><br /><br /><p> Well, thats all for now, I hope this helps some of us who were struggling with one place solution to execute RoutedCommands in code-behind. Hopefully, I will write  one more brief article on using System.Windows.Interactivity.Triggers to redirect an event to a command, the MVVM way of executing actions. </p>  


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2010-07-20">20 Jul 2010</time> </span>
            <h2 class="post-title"><a href="/2010/07/20/Bing%21-Are-you-kidding-me%21.html">Bing! Are you kidding me!</a></h2>

        </header>
        <section class="post-excerpt">
            <p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/TEUhHzpxbrI/AAAAAAAABaM/JVYQ5b43lN0/s1600-h/image%5B3%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_Oy9HuksgrdU/TEUhInM_e2I/AAAAAAAABaQ/eBb6TyGHYJU/image_thumb%5B1%5D.png?imgmax=800" width="644" height="440"></a></p>  <p>Seriously?? If these things happen, Bing! would never be the search engine that I wish it would become.</p>  


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2010-07-16">16 Jul 2010</time> </span>
            <h2 class="post-title"><a href="/2010/07/16/WPF-Datagrid-%E2%80%93-Load-and-Performance.html">WPF Datagrid – Load and Performance</a></h2>

        </header>
        <section class="post-excerpt">
            <p>This post is not about performance numbers of WPF Datagrid but simply about what you should be aware of in order to make it perform well. I was not motivated enough to use profiler to show realistic numbers but instead used the Stopwatch class wherever applicable. This post does not go into techniques to handle large amounts of data such as Paging or how to implement paging, but focuses on how to make the datagrid work with large data.</p> <p>Here is the C# class that generates the data I want to load the Datagrid with.</p><pre class="csharp" name="code">public class DataItem<br />    {<br />        public long Id { get; set; }<br />        public string FirstName { get; set; }<br />        public string LastName { get; set; }<br />        public long Age { get; set; }<br />        public string City { get; set; }<br />        public string Designation { get; set; }<br />        public string Department { get; set; }<br />    }<br /><br />    public static class DataGenerator<br />    {<br />        private static int _next = 1;<br />        public static IEnumerable<dataitem> GetData(int count)<br />        {<br />            for (var i = 0; i &lt; count; i++)<br />            {<br />                string nextRandomString = NextRandomString(30);<br />                yield return new DataItem<br />                                 {<br />                                     Age = rand.Next(100),<br />                                     City = nextRandomString,<br />                                     Department = nextRandomString,<br />                                     Designation = nextRandomString,<br />                                     FirstName = nextRandomString,<br />                                     LastName = nextRandomString,<br />                                     Id = _next++<br />                                 };<br />            }<br />        }<br /><br />        private static readonly Random rand = new Random();<br /><br />        private static string NextRandomString(int size)<br />        {<br />            var bytes = new byte[size];<br />            rand.NextBytes(bytes);<br />            return Encoding.UTF8.GetString(bytes);<br />        }<br />    }<br /></pre><br /><p>My ViewModel has been defined as shown below.</p><pre class="csharp" name="code"> public class MainWindowViewModel : INotifyPropertyChanged<br />    {<br />        private void Notify(string propName)<br />        {<br />            if (PropertyChanged != null)<br />                PropertyChanged(this, new PropertyChangedEventArgs(propName));<br />        }<br />        public event PropertyChangedEventHandler PropertyChanged;<br /><br />        private Dispatcher _current;<br />        public MainWindowViewModel()<br />        {<br />            _current = Dispatcher.CurrentDispatcher;<br />            DataSize = 50;<br />            EnableGrid = true;<br />            _data = new ObservableCollection<dataitem>();<br />        }<br /><br />        private int _dataSize;<br />        public int DataSize<br />        {<br />            get { return _dataSize; }<br />            set<br />            {<br />                LoadData(value - _dataSize);<br />                _dataSize = value;<br />                Notify("DataSize");<br />            }<br />        }<br /><br />        private ObservableCollection<dataitem> _data;<br />        public ObservableCollection<dataitem> Data<br />        {<br />            get { return _data; }<br />            set<br />            {<br />                _data = value;<br />                Notify("Data");<br />            }<br />        }<br /><br />        private bool _enableGrid;<br />        public bool EnableGrid<br />        {<br />            get { return _enableGrid; }<br />            set { _enableGrid = value; Notify("EnableGrid"); }<br />        }<br /><br />        private void LoadData(int more)<br />        {<br />            Action act = () =&gt;<br />                             {<br />                                 EnableGrid = false;<br />                                 if (more &gt; 0)<br />                                 {<br />                                     foreach (var item in DataGenerator.GetData(more))<br />                                         _data.Add(item);<br />                                 }<br />                                 else<br />                                 {<br />                                     int itemsToRemove = -1 * more;<br />                                     for (var i = 0; i &lt; itemsToRemove; i++)<br />                                         _data.RemoveAt(_data.Count - i - 1);<br />                                 }<br />                                 EnableGrid = true;<br />                             };<br />            //act.BeginInvoke(null, null);<br />            _current.BeginInvoke(act, DispatcherPriority.ApplicationIdle);<br />        }<br />    }<br /></pre><br /><p>As you can see, as the DataSize is changed, the data would be loaded. Currently I use a slider to change the load size. This is all pretty easy and fun stuff starts in the XAML.</p><br /><p>In order to apply this "Data" to my WPF datagrid, I apply this viewmodel instance to the DataContext of my class. See below for the code-behind that I have for my window</p><pre class="csharp" name="code"> public partial class MainWindow : Window<br />    {<br />        private MainWindowViewModel vm;<br /><br />        public MainWindow()<br />        {<br />            InitializeComponent();<br />            vm = new MainWindowViewModel();<br />            this.Loaded += (s, e) =&gt; DataContext = vm;<br />        }<br />    }<br /></pre><br /><p>Lets start with the following XAML.</p><br /><p></p><pre class="xml" name="code">&lt;stackpanel&gt;<br />	&lt;slider maximum="100" minimum="50" value="{Binding DataSize}" /&gt;<br />        &lt;label grid.row="1" content="{Binding DataSize}"&gt;<br />        &lt;datagrid grid.row="2" isenabled="{Binding EnableGrid}" itemssource="{Binding Data}"&gt;<br />	&lt;/datagrid&gt;<br />&lt;/stackpanel&gt;<br /></pre><br /><p>Now build the application and run. The result appear as shown below. </p><br /><p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/TEDXbtApboI/AAAAAAAABZc/3rdhYAAloCQ/s1600-h/image%5B3%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/TEDXdbsXOVI/AAAAAAAABZg/6v5-_uHi5bU/image_thumb%5B1%5D.png?imgmax=800" width="644" height="342"></a></p><br /><p>As you can see above, I loaded 100 items yet <strong>I do not see the scrollbar.</strong> Lets change the slider’s Maximum property from 100 to 1000 and rerun the application. Dragging the slider to 1000 at once. So even for the 1000 items, the grid does not respond that well. </p><br /><p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/TEDXese1pQI/AAAAAAAABZk/Lf5WvtHpv-Y/s1600-h/image%5B7%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/TEDXgOGsWcI/AAAAAAAABZo/B66G-Pnfbj8/image_thumb%5B3%5D.png?imgmax=800" width="463" height="300"></a> </p><br /><p>Let us look at the memory usage.</p><br /><p><a href="http://lh5.ggpht.com/_Oy9HuksgrdU/TEDXg-J5y0I/AAAAAAAABZs/qussD_l9bj4/s1600-h/image%5B13%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/TEDXiOXsUvI/AAAAAAAABZw/iU1PwM3QkSg/image_thumb%5B7%5D.png?imgmax=800" width="433" height="38"></a> </p><br /><p>This is pretty heavy for an application with just 1000 items of data loaded. So what is using all this memory? You can hook up a Memory Profiler or use Windbg to look at the memory content but since I already know what is causing this issue, I am not going through that. </p><br /><p>This issue is that the DataGrid has been placed inside a StackPanel. When vertically stacked, the StackPanel basically gives its children all the space that they ask for. This makes the DataGrid create 1000 rows (all the UI elements needed for each column of each row !!) and render it. The virtualization of the DataGrid did not come into play here.</p><br /><p>So let us make a simple change and put the DataGrid inside a grid. The XAML for which is shown below.</p><pre class="xml" name="code">&lt;Grid&gt;<br />        &lt;Grid.RowDefinitions&gt;<br />            &lt;RowDefinition Height="30"/&gt;<br />            &lt;RowDefinition Height="30"/&gt;<br />            &lt;RowDefinition Height="*"/&gt;<br />        &lt;/Grid.RowDefinitions&gt;<br />        &lt;Slider Value="{Binding DataSize}" Minimum="50" Maximum="1000"/&gt;<br />        &lt;Label Content="{Binding DataSize}" Grid.Row="1"/&gt;<br />        &lt;DataGrid ItemsSource="{Binding Data}" Grid.Row="2" IsEnabled="{Binding EnableGrid}"&gt;           <br />        &lt;/DataGrid&gt;<br />    &lt;/Grid&gt;<br /></pre><br /><p>When I run the application, you would notice that as I load 1000 items, the performance of the same application (no code changes, except that XAML one I just talked about) is a lot better than what it was. Moreover I see nice scrollbars.</p><br /><p></p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/TEDXklUvTrI/AAAAAAAABZ0/QRDfmfugJvc/s1600-h/image%5B19%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_Oy9HuksgrdU/TEDXmBiLhWI/AAAAAAAABZ4/inpHNDHNOIY/image_thumb%5B11%5D.png?imgmax=800" width="644" height="342"></a> <br /><p>Let us look at the memory usage.</p><br /><p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/TEDXmkYFIJI/AAAAAAAABZ8/2Eip9xZ103Q/s1600-h/image%5B23%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_Oy9HuksgrdU/TEDXn2IrfBI/AAAAAAAABaA/PxbE3KnIMJc/image_thumb%5B13%5D.png?imgmax=800" width="644" height="29"></a> </p><br /><p>Wow! 10 folds difference. This until now appears to be a re-talk about my <a href="http://krishnabhargav.blogspot.com/2008/10/wpf-performance-ui-virtualization.html">previous post on WPF Virtualization</a>. The same rules applies to DataGrid as well. Read this post if you are intertested.</p><br /><p>So what else am I talking here. </p><br /><ul><br /><li>If you notice the ViewModel code, you should be seeing that I disable the grid as I load data and enable it back once I am done. I have not really tested to see if this technique helps, but I did use this technique in HTML pages where loads of items in a listbox were all to be selected and this technique was very useful. <br /><li>In all the screenshots I showed, the grid is sorted. So as the data changes, the grid has to keep sorting the data and show based on what you chose to sort. This, I believe, is a big overhead. Consider removing sort of the datagrid before you change the data if it is a viable option and does not impact the end user. Have not tested this, but the same should apply to the groupings as well (which most of the time cannot be simply removed).</li></ul><br /><p>With a simple point of loading the DataGrid into any other panel like Grid, instead of a StackPanel you get to see a lot of difference. The WPF datagrid performs just fine, as long as you keep the viewable region of the grid small. </p><br /><p>Shown below is my grid with almost 1 Million data items loaded. The footprint is pretty small compared to the amount of data loaded. This means – either WPF Controls are memory intensive or WPF UI Virtualization is a boon.</p><br /><h3>Impact of sorting on the DataGrid</h3><br /><ul><br /><li>With no sorting applied on the datagrid, it took almost 20 seconds to load 1 Million items into my collection. <br /><li>With sorting enabled, loading half those items iteself took over 2 minutes and the complete items took over 5 minutes and I killed the application because it was a pain. This matters because the application keeps the CPU busy with all the sort that has to keep happening as your data changes. So for every item added, the sort might be triggered, since I am placing it directly into an observable collection. <br /><li><strong>Instead consider sorting on the backend and not using the datagrid.</strong></li></ul><br /><p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/TEDXpTKw1aI/AAAAAAAABaE/MJT3rJfALlk/s1600-h/image%5B31%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_Oy9HuksgrdU/TEDXrgUUjsI/AAAAAAAABaI/yhRUGjP4-Cc/image_thumb%5B19%5D.png?imgmax=800" width="644" height="342"></a> </p><br /><p><em>I can still scroll the application if the virtualization was properly utilized, inspite of the grid binding to 1 million items<strong>.</strong></em></p><br /><h3>USING BeginInit() and EndInit() on the datagrid.</h3><br /><p>I changed the ViewModel’s LoadData() such that it calls BeginInit() as it starts loading the data and EndInit() when it done loading the data. This has helped quite a lot. Loading 1 Million items (without any sort applied on the grid) only took around 8 seconds (compared to the 18 seconds it took earlier). <strong>Unfortunately I did not spend enough time to use a profiler to show real numbers.</strong></p><br /><p>The changed code-behind for the Window is as shown.</p><pre class="csharp" name="code">public partial class MainWindow : Window<br />    {<br />        private MainWindowViewModel vm;<br /><br />        public MainWindow()<br />        {<br />            InitializeComponent();<br />            vm = new MainWindowViewModel();<br />            this.Loaded += (s, e) =&gt; DataContext = vm;<br />            vm.DataChangeStarted += () =&gt; dg.BeginInit();<br />            vm.DataChangeCompleted += () =&gt; dg.EndInit();<br />        }<br />    }<br /></pre><br /><p>I also had to include the DataChangeStarted and DataChangeCompleted actions to the Viewmodel class. The changed portion of the ViewModel class is shown below.</p><pre class="csharp" name="code">	public event Action DataChangeStarted ;<br />        public event Action DataChangeCompleted;<br /><br />        private void LoadData(int more)<br />        {<br />            Action act = () =&gt;<br />                             {<br />				 //Before the data starts change, call the method.<br />                                 if (DataChangeStarted != null) DataChangeStarted();<br />                                 var sw = Stopwatch.StartNew();<br />                                 EnableGrid = false;<br />                                 if (more &gt; 0)<br />                                 {<br />                                     foreach (var item in DataGenerator.GetData(more))<br />                                         _data.Add(item);<br />                                 }<br />                                 else<br />                                 {<br />                                     int itemsToRemove = -1 * more;<br />                                     for (var i = 0; i &lt; itemsToRemove; i++)<br />                                         _data.RemoveAt(_data.Count - i - 1);<br />                                 }<br />                                 EnableGrid = true;<br />                                 sw.Stop();<br />                                 Debug.WriteLine(sw.ElapsedMilliseconds);<br />                                 if (DataChangeCompleted != null) DataChangeCompleted();<br />                             };<br />            //act.BeginInvoke(null, null);<br />            _current.BeginInvoke(act, DispatcherPriority.ApplicationIdle);<br />        }<br /></pre><br /><p>You can try this out and notice the performance difference yourself. </p><br /><p>If the sorting is applied on the datagrid, the performance still hurts in spite of using the above mentioned trick. The overhead of sorting out weighs the performance gain we get calling the BeginInit and EndInit. May be having 1 million records is not realistic enough. </p>  


        </section>
    </article>

    

    <article class="post">
        <header class="post-header">
            <span class="post-meta"><time datetime="2010-07-16">16 Jul 2010</time> </span>
            <h2 class="post-title"><a href="/2010/07/16/Algorithms%2C-performance-and-getting-burnt.html">Algorithms, performance and getting burnt</a></h2>

        </header>
        <section class="post-excerpt">
            After a long time, I am writing something on my blog. So here it is ..<p>This post is about me starting to solve a small but interesting problem with different approaches and ended up breaking my head against why an algorithm with supposedly O(n) complexity is 4 times slower than O(n^2).</p><p>So here's the issue. I have the following data : </p><p>Name,Value <p/><br />Sridhar,1<p/><br />Ashish,2<p/><br />Prasanth,3<p/><br />Sridhar,4<p/><br />Ashish,5<p/><br />Sridhar,8</p><p>and so on .. I hope you get the idea.<br /><br />Now what I would like to do is to print the following output.<p/><br />Sridhar : 1;4;8;....<p/><br />Ashish : 2;4;.....<p/><br />Prasanth: 3;......<p/><br /><br />Note that here, it does not matter what the values are, I am giving this data just for the example. So shown below is my setup which would be used by my implementations. (I am demoing it as a test).<br /></p><br /><pre name="code" class="csharp"><br />  private Stopwatch sw;<br />        [SetUp]<br />        public void SetUp()<br />        {<br />            GC.GetTotalMemory(true); // I dont know why i did this!<br />            tl = new List<Ud>(10000);<br />            var names = new[] { "Krishna", "Ashish", "Sridhar", "Prasanth" };<br />            foreach (var name in names)<br />                for (var i = 0; i < 2500; i++)<br />                    tl.Add(new Ud { Name = name, DrawerId = i.ToString() });<br />            tl.OrderBy(s => s.DrawerId);<br />            sw = Stopwatch.StartNew();<br />        }<br /><br />        [TearDown]<br />        public void TearDown()<br />        {<br />            sw.Stop();<br />            Console.WriteLine(sw.ElapsedMilliseconds);<br />            sw = null;<br />        }<br /><br />        public class Ud<br />        {<br />            public string Name { get; set; }<br />            public string DrawerId { get; set; }<br />        }<br /><br />        private List<Ud> tl;<br /></pre><br /><p>The above code is self explanatory. I basically create a lot of Ud objects which generate the data that I presented earlier. Shown below is the most straight forward way to do it. It has two for-loops which makes the complexity O(n^2).</p><br /><pre name="code" class="csharp"><br />[Test]<br />        public void BasicImplementation()<br />        {<br />            var nvcs = new List<NameValueCollection>();<br />            var list = new List<string>();<br />            foreach (var item in tl)<br />            {<br />                if (list.Contains(item.Name)) continue;<br /><br />                string val = string.Empty;<br /><br />                foreach (var item2 in tl)<br />                {<br />                    if (item2.Name == item.Name)<br />                        val += item2.DrawerId + ";";<br />                }<br /><br />                nvcs.Add(new NameValueCollection { { "Name", item.Name }, { "DrawerId", val } });<br />                list.Add(item.Name);<br />            }<br />            //foreach (var nvc in nvcs)<br />            //    Console.WriteLine(nvc["Name"] + " : " + nvc["DrawerId"]);<br />            Assert.AreEqual(4, nvcs.Count);<br />        }<br /></pre><br /><p> Now I went ahead and added another potential implementation which gives the same result but instead makes use of dictionary to track the strings that we build for each name in the list of objects. So instinctively, it appears that the dictionary method would be way faster than the one mentioned above. Lets look at that code. </p><br /><pre name="code" class="csharp"><br />        [Test]<br />        public void ADictionary()<br />        {<br />            var vals = new Dictionary<string, string>();<br />            foreach (var item in tl)<br />            {<br />                if (!vals.ContainsKey(item.Name))<br />                    vals[item.Name] = item.DrawerId;<br />                else<br />                    vals[item.Name] = vals[item.Name] + item.DrawerId + ";";<br />            }<br />            Assert.AreEqual(4, vals.Values.Count);<br />        }<br /></pre><br /><p> When I ran these two tests, I did not notice any performance gain with the above O(n) implementation and in fact it was three times slower. So why was it slower? Look at the setup, it has GC.GetTotalMemory(true) which forced a full garbage collection and its time was accounted in the time consumed by this dictionary as well since for the second time (when test with dictionary was executing) it had a lot of strings to clean up. So why did I put it in the first place? The answer is "I was not thinking straight". Never ever use GC classes in your code. It is a bad-bad-bad practice.</p><br /><p>So I remove this GC call made and rerun the tests again. Yet I do not see any performance gain. WHY?? I took a lot of time trying to diagnose why this is happening and eventually gave up manual inspection. I downloaded the trail version of dotTrace (which is freaking awesome tool) Performance 4.0 and made it profile both the tests. The culprit was the strings. If you look at the code right, we are generate a lot of strings whose "Concat" operation was so time consuming that it dominated the gain that we obtained using O(n) algorithm.</p><br /><p>So the lesson here is "Be watchful of the strings that are generated when your code executes, otherwise you would be burned". It does not matter how small the string concatenation may seem but in cases like above it piles up a lot and screws up your clever algorithm. All I did was to change the tests to use stringbuilder instead of Strings.</p> <br /><ul><br /><li> Do not use GC calls in your code, especially those which force GC.<br /><li> Use a profiler to accurately capture performance information of specific methods or your program. Stopwatch, Timers, etc are not good enough and waste of time.<br /><li> Be aware of the impact of string operations. Use StringBuilder wherever possible. Use String.Format() in other simpler cases.<br /></ul><br />I will continue in the next post with some code that shows you how to approach the problem I initially started with using LINQ and how simple things would appear.


        </section>
    </article>

    

    <nav class="pagination" role="pagination">

        

        <span class="page-number"> Page 1 of 13 </span>
        
         
        <a class="older-posts" href="/page2/" title="Next Page">Older Posts &raquo;</a>
         
    </nav>
    

</main>


    <footer class="site-footer">
        <a class="subscribe icon-feed" href="/rss.xml"><span class="tooltip">Subscribe!</span></a>
        <div class="inner">
             <section class="copyright">All content copyright <a href="/">Vedhava Sodhi</a> &copy;  &bull; All rights reserved.</section>
             <section class="poweredby">Made with Jekyll using <a href="http://github.com/rosario/kasper">Kasper theme</a></section>
        </div>
    </footer>

    
    <script type="text/javascript" src="/assets/js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-XXXXXXXX-X']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>   
</body>
</html>
