<!DOCTYPE html>
<html>
<head>   
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Vedhava Sodhi - Musings of a Software Engineer v2.0</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <!-- This is for syntax highlight -->
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

</head>
<body class="home-template">

    
    <main class="content" role="main">

    <article class="post">
        <header class="post-header">
            <a id="blog-logo" href="/">
                
                    <span class="blog-title">Vedhava Sodhi</span>
                 
            </a>
        </header>
        
        <span class="post-meta">
        	<time datetime="2008-02-25">25 Feb 2008</time>
        	
        		on
	        	
	        
       	</span>

        <h1 class="post-title">Normalization Techniques in C# 3.0</h1>

        <section class="post-content">
            <p align="justify"><strong>What do you get from this post?</strong>  <p align="justify">In this post I would talk elaborately about implementing Normalization Techniques like BCNF Decomposition, 3NF Synthesis and pre-requisites like Test for Losslessness, finding minimal cover of a given set of functional dependencies, etc. I would not be posting the entire source code here, as the intention of this post is to help users get started to write "real" code but not to make their life simple by pasting the code. So the code snippets I paste would be "images" and not text! I apologize for my sadism but I would not like it when my students rip off source code off Google and submit it.  <p align="justify">Following this would not only help you learn Normalization techniques but also give you better idea about C# 3.0 features and how to apply them in a real situation. If you are looking at this post, then probably you know C#.  <p align="justify"><strong>What will I learn?</strong>  <ol> <li> <div align="justify">BCNF Decomposition Algorithm</div> <li> <div align="justify">3NF Synthesis</div> <li> <div align="justify">How to find if a schema is in BCNF?</div> <li> <div align="justify">How to find the minimal cover of the set of functional dependencies?</div> <li> <div align="justify">How to find the closure of an FD?</div> <li> <div align="justify">Using C# 3.0 Extension Methods</div> <li> <div align="justify">Using Object Initializers</div> <li> <div align="justify">Using Lambda Expressions in C#</div> <li> <div align="justify">Using Linq to write compact code</div> <li> <div align="justify">A lot other stuff ....</div></li></ol> <p align="justify">Did I mention, it took only 540 lines of code to implement both the BCNF Decomposition and 3NF synthesis?</p> <p align="justify"><strong>Assumptions</strong></p> <p align="justify">This post assumes you are familiar with what Normalization is. You have a schema R and a set of Functional dependencies, then normalization is a&nbsp; technique to split the schema R into set of sub-schemas Ri such that each sub schema is in a particular normal form.  <p align="justify">Most highly recommended normal forms are the BCNF and 3NF. 3NF is a less strict normal form than the Boyce-Codd Normal form. There are so called the "design algorithms" that researchers have proposed to normalization a given schema.  <p align="justify"><strong>What is BCNF?</strong>  <p align="justify">I would not talk about definitions here. If you need elaborate answers then visit <a href="http://en.wikipedia.org/wiki/Boyce-Codd_normal_form" target="_blank">this link at Wikipedia</a>. Simply put, a table<strong> Ri </strong>is said to be <strong>NOT </strong>in BCNF if there is atleast one functional dependency <strong>X-&gt;Y</strong> that satisfies the schema such that X is not a candidate key. I talked about a relation not being in BCNF because that is what matters during implementation, as you will see later. A positive definition would be : <strong>Ri</strong> is said to be in BCNF if the Left hand side of all its FDs is a candidate key.  <p align="justify"><strong>Getting started</strong>  <p align="justify">Clearly if we are going to implement normal forms, we would need to represent a "Relation", a "Functional Dependency", etc. So the way I organized the system can be seen below. It is a class diagram taken from Visual Studio. Click on the figure below to look at the classes involved.  <p align="justify"><a href="http://lh3.google.com/krishbhargava/R8Js0-i1-yI/AAAAAAAAAOE/9qLQLY5vhhE/ClassDiagram%5B3%5D" target="_blank"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="384" alt="ClassDiagram" src="http://lh4.google.com/krishbhargava/R8JrOOi1-XI/AAAAAAAAAOM/lh5izQqxJZE/ClassDiagram_thumb%5B2%5D" width="644" border="0"></a> </p> <p align="justify"><strong>Relation </strong>class  <p align="justify">The heart of the implementation is the Relation class. Think properly, how do you define relation mathematically? What interests you about relation? Well, for me, I am bothered with the <strong>R </strong>and the set of functional dependencies and that is what I have in my relation class.  <p align="justify"><a href="http://lh6.google.com/krishbhargava/R8JrOui1-YI/AAAAAAAAAOQ/NYoE0zH6CeA/image%5B67%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="188" alt="Relation class" src="http://lh4.google.com/krishbhargava/R8JrQOi1-ZI/AAAAAAAAAOU/KxBwZk8dB4Q/image_thumb%5B42%5D" width="644" border="0"></a> </p> <p align="justify">You can notice that I have a list of Functional Dependencies. I represent each FD as a seperate class called "FunctionalDependency". Assume for now that you have such a class. So what next? You might be interested to implement a closure algorithm, right? But I implemented in FunctionalDependency class. I would talk about the methods when and where required. For now, let us move on to the other important class</p> <p align="justify"><strong>FunctionalDependency </strong>class</p> <p align="justify">So again, the same question - What do you think should be the state of an object that represents a functional dependency? Well, again my answer is that it should have LHS,RHS(where LHS-&gt;RHS is the FD),&nbsp; an equivalent "R" which is nothing but LHS+RHS. Also it would be good if we have a member that states if this FD violates BCNF or not? We might also use this member for other instances too where it might violate a different condition. So the functional dependency state would like shown below.</p> <p align="justify"><a href="http://lh4.google.com/krishbhargava/R8JrROi1-aI/AAAAAAAAAOY/GmspaW2eawk/image4%5B2%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="165" alt="Functional Dependency C#" src="http://lh4.google.com/krishbhargava/R8JrTOi1-bI/AAAAAAAAAOc/9kHn5tk4wOk/image4_thumb%5B1%5D" width="644" border="0"></a></p> <p align="justify">So why the hell did I&nbsp; chose R, LHS,RHS all to be strings? An example of R would be like "ABCDEFGH" where each letter corresponds to an attribute. So instead of working hard with a list or an array, it would be easier to work with strings(we have string#ToCharArray() to our rescue). But this would require us to write a set of methods that would let you perform set like operations on the strings. For example, if you merge two schemas "ABC" and "BCD" you expect to get "ABCD". But a string <strong>+</strong> would give you "ABCBCD". So we need a method like "ABC".SetAdd("BCD") which would give return "ABCD" instead of "ABCBCD". So here comes the extension methods. </p> <p align="justify"><strong>How do we implement extension methods in C#?</strong></p> <p align="justify">The important point to remember is that extension methods should be implemented in <strong>static classes</strong> only. The methods I implemented that perform "set-operations" on strings are SetAdd(),SetMinus(),SetEquals(). The code implemented makes good use of LINQ extension methods. And since I intend to concentrate on Normalization in this post, I would skip detailed explanation about extension methods.</p> <p align="justify"><a href="http://lh5.google.com/krishbhargava/R8JrUei1-cI/AAAAAAAAAOg/C3uKGTunnKs/image11%5B2%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="231" alt="Extension Methods in C#" src="http://lh5.google.com/krishbhargava/R8JrWei1-dI/AAAAAAAAAOk/3pIKrNh-f94/image11_thumb%5B1%5D" width="644" border="0"></a></p> <p align="justify">Note that the class is <strong>static</strong> and the method is <strong>static. </strong>Another point to note that the first parameter is marked as <strong>"this string"</strong> meaning we wish to make SetMinus() as an extension method to the string class. After this, we could use SetMinus() as shown below.</p> <div align="justify"><pre><span style="color: #0000ff">string</span> s = "<span style="color: #8b0000">Krishna</span>";<br /><span style="color: #0000ff">string</span> output = s.SetMinus("<span style="color: #8b0000">kna</span>");<br />Console.WriteLine(output);<span style="color: #008000">//prints "rish"</span></pre></div><br /><p align="justify">In the above method, I am just taking all the characters in the "x" which are not in the string set that is to be "minus"d. See how sweet LINQ and Lambda expressions are.</p><br /><p align="justify">The other methods are listed. I hope you understand the statements, if not, drop me an email so that I can write down explanation. Note that all these methods are in the same static class StringUtilities.</p><br /><p align="justify"><a href="http://lh6.google.com/krishbhargava/R8JrXui1-eI/AAAAAAAAAOo/OlCl7Fd5jZc/image15%5B1%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="268" alt="Extension methods in C#" src="http://lh6.google.com/krishbhargava/R8JrZui1-fI/AAAAAAAAAOs/kvBjDPPJI-E/image15_thumb" width="644" border="0"></a></p><br /><p align="justify">The SetAdd() makes use LINQ expressions to find all the unique characters that are in setToAdd and that are not in the actual expression. It also makes clever use of LINQ aggregator method <strong>Distinct(). </strong>One thing I noticed is that as a beginner developer you would pride in writing programs with more lines of code. But as you mature as a developer you would enjoy writing compact code and these days nothing gives me more satisfaction than writing one liner or two liner to do a good job.</p><br /><p align="justify">Anyway now that we are set to start, we can now look at how decomposition is implemented. For programing sake, I have a super class called <strong>Decomposition</strong> which can be seen in the class diagram above. The class listing is shown below.</p><br /><p align="justify"><a href="http://lh5.google.com/krishbhargava/R8Jrcei1-gI/AAAAAAAAAOw/VRSnn_TfZK8/image%5B66%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="442" alt="image" src="http://lh6.google.com/krishbhargava/R8Jreui1-hI/AAAAAAAAAO0/NmyHajGnUhQ/image_thumb%5B41%5D" width="644" border="0"></a> </p><br /><p align="justify">The static method <strong>GetUnpreservedDependencies()</strong> is not yet implemented and the idea is to implement it using <a href="http://en.wikipedia.org/wiki/Armstrong's_axioms" target="_blank">Armstrong's axioms</a>.</p><br /><p align="justify">The method <strong>IsLossLess()</strong> takes in a Decomposition object and returns true if the decomposition is lossless and false otherwise. This is used to test our implementation of both BCNF decomposition and 3NF Sythesis - both of which are theoretically lossless. The Decomposition class defines an abstract method <strong>ApplyDecomposition()</strong> which should be implemented by the inheriting classes. It returns the list of decomposed schemas which is also the <strong>"DecomposedSchemas" </strong>property. I know schemas is not a correct word and a plural for schema is just schema, so forgive me. Now let us look at the BCNF Decomposition algorithm.</p><br /><p align="justify"><strong>BCNF Decomposition in C#</strong></p><br /><p align="justify">The algorithm to implement BCNF Decomposition is</p><br /><ol><br /><li><br /><div align="justify">Add the current relation (of type <strong>Relation</strong>) to the list of DecomposedSchemas.</div></li><br /><li><br /><div align="justify">Get all the schema that is not in BCNF. Check the Relation for BCNF violation using the method <strong>InBCNF(Relation r) </strong>which is listed as shown below.<br><a href="http://lh6.google.com/krishbhargava/R8Jrfui1-iI/AAAAAAAAAO4/1xMrt75V0tg/image%5B65%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="143" alt="Test for BCNF C#" src="http://lh5.google.com/krishbhargava/R8Jrhei1-jI/AAAAAAAAAO8/m_HAqVGAX-U/image_thumb%5B40%5D" width="523" border="0"></a> </div></li><br /><li><br /><div align="justify">If there are no such schema that violate BCNF, then you quit.</div></li><br /><li><br /><div align="justify">For any schema <strong>sch </strong>that is not in BCNF, do the following steps.</div></li><br /><ol><br /><li><br /><div align="justify">Pick a functional dependency that violates BCNF. There is a method in <strong>Relation#GetViolations()</strong> that returns a list of violating FunctionalDependencies. Its implementation is shown below.<br><a href="http://lh6.google.com/krishbhargava/R8Jrjui1-kI/AAAAAAAAAPA/0VgL5EUcGnc/image%5B62%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="280" alt="Get BCNF Violations" src="http://lh4.google.com/krishbhargava/R8JrnOi1-lI/AAAAAAAAAPE/-w5aL7ML304/image_thumb%5B37%5D" width="644" border="0"></a><br>A dependency "dep" violates BCNF if its closure does not result in R, the actual schema. The closure is computed using all the Dependencies in the relation. It is defined in the FunctionalDependency class as listed below.<br><a href="http://lh4.google.com/krishbhargava/R8JrqOi1-mI/AAAAAAAAAPI/lxI4l5aCmEc/image%5B61%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="182" alt="Database Closure in C#" src="http://lh3.google.com/krishbhargava/R8Jrt-i1-nI/AAAAAAAAAPM/ckQwf4i2Miw/image_thumb%5B36%5D" width="644" border="0"></a><br>The algorithm is taken from the book <strong><a href="http://www.pearsonhighered.com/academic/product/0,3110,0321268458,00.html" target="_blank">Database Systems:An Application Oriented Approach</a></strong></div></li><br /><li><br /><div align="justify">Having picked a FD(x-&gt;y) that violates BCNF, you now get two relations called <strong>r </strong>(right) and <strong>l </strong>(left), where l = FD.EquivalentR (which is x+y) and r = (sch.R - FD.RHS)+FD.LHS (Which is Y). You add both the schema to the DecomposedSchemas collection. </div></li></ol><br /><li><br /><div align="justify">Return the list of decomposed schema. </div></li></ol><br /><p align="justify">The code listing for the entire BCNF Decomposition is shown below.<br>&nbsp;<a href="http://lh4.google.com/krishbhargava/R8JryOi1-oI/AAAAAAAAAPQ/r1xOoClP69k/image%5B60%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="333" alt="BCNF Decomposition in C#" src="http://lh4.google.com/krishbhargava/R8Jr4Oi1-pI/AAAAAAAAAPU/RB3DkhunrAc/image_thumb%5B35%5D" width="644" border="0"></a></p><br /><p align="justify"> Just a recap of what we have seen till now in this post. We have looked at how to compute closure in C#, how to implement the BCNF decomposition algorithm, how to use extension methods, how to use LINQ query to fetch unique characters. For this section, finally we will look at how to test the BCNF Decomposition we implemented. The output you see would be something like this.<br><a href="http://lh3.google.com/krishbhargava/R8Jr7-i1-qI/AAAAAAAAANA/N23SnUANUs0/image%5B29%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="344" alt="BCNF Decomposition Output window" src="http://lh3.google.com/krishbhargava/R8Jr_-i1-rI/AAAAAAAAANI/-uxltwu6yzY/image_thumb%5B14%5D" width="681" border="0"></a><br>The main method is shown below.<br><a href="http://lh3.google.com/krishbhargava/R8JsB-i1-sI/AAAAAAAAAPY/0KRFuScizY4/image%5B59%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="324" alt="Running the example" src="http://lh3.google.com/krishbhargava/R8JsE-i1-tI/AAAAAAAAAPc/L4Inx0zhN_0/image_thumb%5B34%5D" width="644" border="0"></a>&nbsp; </p><br /><p align="justify">You can see a very badly highlighted method GetRelation3() which returns a Relation. The method listing is shown below. This method also shows on how we actually constructed our relation.<br>&nbsp;<a href="http://lh6.google.com/krishbhargava/R8JsIui1-uI/AAAAAAAAAPg/pvRMza9mNiE/image%5B58%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="484" alt="Object Initializers Usage - relation demo" src="http://lh5.google.com/krishbhargava/R8JsOei1-vI/AAAAAAAAAPk/pwP7dzHmt3g/image_thumb%5B33%5D" width="555" border="0"></a>  </p><br /><p align="justify">In the above code you can see other sample relations too. But look at the syntax for <strong>Object initializers. (the one marked in yellow)</strong>. For both Relation as well as FunctionalDependency creation, we have made use of the beautiful initializers saving us atleast 50 lines of code for all the examples.</p><br /><p align="justify">So how did we test for losslessness?</p><br /><p align="justify"><strong>Testing for losslessness in decomposition</strong></p><br /><p align="justify">The key is the theorem which states </p><br /><p align="justify">"If a closure of Ri gives R, then the decomposition is lossless". </p><br /><p align="justify">The implementation is simple. For all subschema obtained, we compute its closure using the dependencies of the original schema. It the resultant of the closure gives R for any of the subschema, then the decomposition is lossless. Now you might be confused and might be wondering if you need to write new code! to compute closure for schema. The answer is no! remember you have implemented closure method in the FunctionalDependency class. You can create a new FD whose LHS is Ri and RHS is empty and then call the method GetCLosure(). This works like magic and without any additional code! The complete code is listed below. Notice that we are not bothered if the decomposition is BCNF Decomposition or 3NF synthesis. We can check for any such decomposition for its losslessness nature.<br><a href="http://lh3.google.com/krishbhargava/R8JsP-i1-wI/AAAAAAAAAPo/v_OaO8OycBg/image%5B57%5D"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="235" alt="Test for losslessness BCNF/3NF Decomposition" src="http://lh3.google.com/krishbhargava/R8JsR-i1-xI/AAAAAAAAAPs/Mfqtjj-0LPk/image_thumb%5B32%5D" width="644" border="0"></a> </p><br /><p align="justify">Now that we have looked at BCNF Decomposition and also a good C# 3.0 features that enables developers write some good compact code, we would look at 3NF synthesis in the next post. I hope this post is informative enough to get you started. I have shown all the code and with clever reading of Class diagram picture and the snippets you should be able to implement the decomposition algorithm by yourself. </p>  
        </section>

        

        <footer class="post-footer">
        	<!-- If we want to display author's name and bio -->
            

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Normalization Techniques in C# 3.0&amp;url=/2008/02/25/Normalization-Techniques-in-C%23-3.0.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=/2008/02/25/Normalization-Techniques-in-C%23-3.0.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=/2008/02/25/Normalization-Techniques-in-C%23-3.0.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            
        	
        </footer>

    </article>

</main>


    <footer class="site-footer">
        <a class="subscribe icon-feed" href="/rss.xml"><span class="tooltip">Subscribe!</span></a>
        <div class="inner">
             <section class="copyright">All content copyright <a href="/">Vedhava Sodhi</a> &copy;  &bull; All rights reserved.</section>
             <section class="poweredby">Made with Jekyll using <a href="http://github.com/rosario/kasper">Kasper theme</a></section>
        </div>
    </footer>

    
    <script type="text/javascript" src="/assets/js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-XXXXXXXX-X']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>   
</body>
</html>
