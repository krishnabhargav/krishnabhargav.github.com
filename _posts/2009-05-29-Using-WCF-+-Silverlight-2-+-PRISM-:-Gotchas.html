---           
layout: post
title: Using WCF + Silverlight 2 + PRISM : Gotchas
date: 2009-05-29 20:54:32 UTC
updated: 2009-05-29 20:54:32 UTC
comments: false
categories: 
---

<p>In this entry, I would be talking about the issues that I have encountered when developing a Silverlight application structured with PRISM principles and that is driven by a WCF service. Some of the issues that I mention here are applicable even when making just Silverlight applications (like Data Binding Hello World!).</p>  <p><strong><u>Gotcha 1 : Working with Data Binding</u></strong></p>  <p>Shown below is the code snippet for startup xaml page – XAML code on the top and code behind at the bottom half.</p>  <p><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLWL1Sa3I/AAAAAAAAA04/bIMatrK06tw/s1600-h/image17.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLWW0J_DI/AAAAAAAAA08/HNp8O_D8Ck8/image_thumb7.png?imgmax=800" width="506" height="484" /></a> </p>  <p>If you observe the XAML, it simply contains a textblock and a textbox which both binds to the same property called “Debug”.</p>  <p>So in the codebehind, I created a property called “Debug” and in the constructor for the page (my page is called Shell), I have set the DataContext to itself. So the Binding Source should be the DataContext of the UserControl which points to itself (the instance of Shell). So Debug property should be taken from the property listed in the Shell class.</p>  <p>While this setup works well in a WPF application, running in Silverlight terminates the application. I have noticed that when “this.DataContext = this” is placed in a Silverlight page, the application would terminate with an exception [AG_E_PARSER_BAD_PROPERTY_VALUE(Line: 8 Position: 42)].</p>  <p><a href="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLWf0X2dI/AAAAAAAAA1A/2g2ZjciW6To/s1600-h/image26.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLWlrjVtI/AAAAAAAAA1E/6W0Jb6ZbfJ0/image_thumb14.png?imgmax=800" width="644" height="248" /></a> </p>  <p>Apparently, <strong>this.DataContext = this</strong> is not being liked by the Silverlight engine. You can comment the XAML inside StackPanel and then try running the application again. You would still notice that the application fails to execute. </p>  <p>So, the lesson learnt here is “<strong><u>unlike in WPF, Silverlight does not like DataContext of a UserControl to be set to itself</u></strong>”.</p>  <p>So how am I going to make it work?</p>  <p>Shown below is the fixed version. We have a&#160; ShellViewModel which is instantiated within the constructor and then the data context is set to this instance.</p>  <p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLW-GUXCI/AAAAAAAAA1I/EzXPJes7744/s1600-h/image34%5B1%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLXCNYC6I/AAAAAAAAA1M/ej9rpp3Gohc/image_thumb18.png?imgmax=800" width="432" height="484" /></a> </p>  <p><strong><u>Gotcha 2: Missing Event Handler Methods can terminate your application</u></strong></p>  <p>Sometimes it so happens that you specify an EventHandler method in XAML but forget to implement the method in code. In that case, the compiler does not throw an error and instead a runtime exception would terminate the application. If you would like to experiment, remove the empty “private void Text….” method inside Shell class and run the application.</p>  <p><strong><u>Gotcha 3 : Data Binding makes no sense without INotifyPropertyChanged.</u></strong></p>  <p>If you look at the last code snippet, in the XAML section, both TextBlock and TextBox bind to the same “Debug” property. Now in the TextBlock LeftMouseButtonUp event handler, lets add a line which changes the value of the “Debug” property, like shown below.</p>  <p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLXZZA6bI/AAAAAAAAA1Q/x6vju3-weCs/s1600-h/image38.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLXZrEaOI/AAAAAAAAA1U/_zQ4ei9nkog/image_thumb20%5B1%5D.png?imgmax=800" width="570" height="484" /></a> </p>  <p>Now, if you run the application, and left click on the TextBlock, the event handler would be executed, the value of Debug would be updated but the UI would still show the same “Click Me!” (the default value for Debug) since it has no idea that the Debug property has been modified.</p>  <p>To fix this and to make the UI thread aware of any changes made to the properties it binds to, the properties should either be made as Depdendency Properties or the Data Context should implement INotifyPropertyChanged and the setter of the properties should raise the PropertyChanged event.</p>  <p><strong><u>Using INotifyPropertyChanged</u></strong></p>  <p>Shown below is the modified ShellViewModel which implements INofityPropertyChanged.</p>  <p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLXpXdLNI/AAAAAAAAA1Y/-UZAC81juXI/s1600-h/image42.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLX4SK8rI/AAAAAAAAA1c/Y25IIsQOzj0/image_thumb22.png?imgmax=800" width="593" height="484" /></a> </p>  <p>Using INotifyPropertyChanged is probably a better way to do things and in fact much simpler to use. In every property, the setter should raise the PropertyChanged event. Thats it!</p>  <p>Now the application works as expected. When you click on the textblock, both the TextBlock and TextBox changes.</p>  <p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLYK2xiaI/AAAAAAAAA1g/-GmyyjGyDac/s1600-h/image45.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLYX1gLtI/AAAAAAAAA1k/bfUZVbiNvlM/image_thumb23.png?imgmax=800" width="135" height="74" /></a> </p>  <p><strong><u>Gotcha 4 : Be aware of Data Binding Default Mode.</u></strong></p>  <p>If you come from a WPF background, like me, then the same set up (XAML + code as shown until now) would behave differently in Silverlight. In WPF, if you change the text inside the textbox and tab out, you would notice the text in the text block change as well. But this does not happen in case of Silverlight. Proof ?? Try it or believe what is shown in the picture below.</p>  <p><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLYdSdRdI/AAAAAAAAA1o/x06XRk_NGDk/s1600-h/image48.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLYoIvzcI/AAAAAAAAA1s/BZ0NXqhRYuM/image_thumb24.png?imgmax=800" width="228" height="75" /></a> </p>  <p>Notice that the text block still shows the old text in spite of the text changed in the textbox (which also binds to the same property as the text block). The reason for this not to work is that in WPF the default Binding Mode is TwoWay, while in Silverlight its OneWay. For those who do not know, TwoWay means changes in the source (data) would also update the target (UI) while OneWay only updates the source when the target is changed by the user (at least that is what I understand they mean).</p>  <p><strong><u>What’s the fix?</u></strong></p>  <p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLYqfz4zI/AAAAAAAAA1w/8xMZQj87c04/s1600-h/image71.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLY3jSSBI/AAAAAAAAA10/imnAIV1rpUM/image_thumb2.png?imgmax=800" width="644" height="168" /></a> </p>  <p><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLZGCGwbI/AAAAAAAAA14/J1HJ1M69swg/s1600-h/image8%5B1%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLZZaTErI/AAAAAAAAA18/UsEGcTJJ-xM/image_thumb3.png?imgmax=800" width="282" height="64" /></a> </p>  <p><strong><u>Silverlight Dependency Properties </u></strong></p>  <p>Look at this article : <a title="http://blogs.sqlxml.org/bryantlikes/archive/2008/12/15/silverlight-dependency-properties.aspx" href="http://blogs.sqlxml.org/bryantlikes/archive/2008/12/15/silverlight-dependency-properties.aspx">http://blogs.sqlxml.org/bryantlikes/archive/2008/12/15/silverlight-dependency-properties.aspx</a></p>  <p>&#160;</p>  <p>Now that I have talked about some fundamental issues one might face when starting Silverlight development, I thought I would dig more into gotchas encountered when working with Composite Silverlight applications driven by WCF services.</p>  <p><strong><u>Gotcha 5: Composite Silverlight Applications – Bootstrapper, ModuleCatalog using XAML</u></strong></p>  <p>Assumptions : I assume you have downloaded the Composite WPF/Silverlight (PRISM) and built the CAL. Shown below are the Silverlight libraries that I have on my machine. I also assume you have basic understanding of what a composite application is, what silverlight module is, etc.</p>  <p><a href="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLZbF7PII/AAAAAAAAA2A/E4ZDiMoXI7w/s1600-h/image13%5B1%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLZlWif8I/AAAAAAAAA2E/UMdronblQX8/image_thumb5.png?imgmax=800" width="244" height="91" /></a> </p>  <p>In the Silverlight project, add reference to the above libraries. Then the first step is to create a <strong>Bootstrapper</strong>. The bootstrapper performs all the required initialization and configuration for the application. Shown below is my Bootstrapper that I have used in one of my silverlight prism applications. </p>  <p>&#160;<a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLZ5CveLI/AAAAAAAAA2I/kqgaflvQHwk/s1600-h/image4%5B1%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLaPCQpDI/AAAAAAAAA2M/l_77tPl8efY/image_thumb1%5B1%5D.png?imgmax=800" width="644" height="439" /></a> </p>  <p>The bootstrapper 1) creates the shell, 2) tells how your modules are cataloged and 3) additionally, it adds new RegionAdapters to existing ones.</p>  <p>The fun part here is the ModulesCatalog.xaml. This XAML file is used to configure my modules and the&#160; contents would be shown in a while. The package uri used is always annoying to me, so I use this URI as a reference and it works. You are free to use this as a reference. Anyway, lets look at the modules catalog.</p>  <p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLagDVdSI/AAAAAAAAA2Q/JL42iG_2Yl0/s1600-h/image8.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLa-3mBuI/AAAAAAAAA2U/3oFVqOyKQHI/image_thumb3%5B1%5D.png?imgmax=800" width="644" height="325" /></a> </p>  <p>Even though each XAP file has only one module, I noticed that for the Module configuration to work properly for both WhenAvailable/OnDemand, ModuleInfoGroup has to be used.</p>  <p>Before we look into how to make each module as a separate XAP file, lets look at how the bootstrapper has been used.&#160; The App.xaml.cs has to be modified in the Application_Start method to reflect the following.</p>  <p><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLbCC6InI/AAAAAAAAA2Y/HRsLYjQJAoU/s1600-h/image12.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLbKE-1mI/AAAAAAAAA2c/BMbgvEww8Pg/image_thumb5%5B1%5D.png?imgmax=800" width="644" height="120" /></a> </p>  <p><strong><u>Gotcha 6 : Preparing a Silverlight module as a XAP File</u></strong></p>  <p>When you create a new Silverlight Library, the output of the project would be a silverlight dll which cannot be used for On Demand loading for PRISM applications. So you have to make your modules to be generated as a XAP files (which are just ZIP files). Follow the steps shown below and you would be good.</p>  <p>1. Add a new Silverlight application project to the solution. Stress on “<strong>Silverlight Application”</strong> not a Silverlight library.</p>  <p><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLbXnlGNI/AAAAAAAAA2g/sMHf00dnp0U/s1600-h/image18.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLbuRw8jI/AAAAAAAAA2k/HFA8GVQCtro/image_thumb9.png?imgmax=800" width="457" height="407" /></a> </p>  <p>Make sure you link the control but you uncheck “Add a test page that references the application”.</p>  <p>2. Delete the App.xaml file.Build the solution. You should see the .xap file added to the ClientBin along with the shell project. Shown below is my project structure after the build. (Notice ethe maya.sample.module.xap and also missing App.xaml inside the module project).</p>  <p><a href="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLb015wuI/AAAAAAAAA2o/2ckLPg2Gn3s/s1600-h/image22.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLb2769jI/AAAAAAAAA2s/ffbi2J7-WHQ/image_thumb11.png?imgmax=800" width="240" height="478" /></a> </p>  <p><strong><u>Sub-Gotcha: What if you already have a silverlight library project and you wish the build to generate a XAP file instead?</u></strong></p>  <p>You have to right click on the silverlight library project and “Edit Project file”. This unloads the project and opens the project file inside XML editor within Visual Studio. (Or you can open it manually in editor of your choice). The first <strong>PropertyGroup</strong> section would like shown below. Notice the SilverlightApplication is set to <strong>false.</strong></p>  <p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLcBaVgaI/AAAAAAAAA2w/NjFkPe_Plgg/s1600-h/image30.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLcRyoXEI/AAAAAAAAA20/sNW2i3Enc7U/image_thumb15.png?imgmax=800" width="644" height="205" /></a> </p>  <p>Make changes such that it looks like shown below. You have to add <strong>XapOutputs </strong>element and set it to true.</p>  <p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLcm1FdbI/AAAAAAAAA24/zs-RZoysC7s/s1600-h/image34.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLc3kNESI/AAAAAAAAA28/u96ksh6u2SU/image_thumb17.png?imgmax=800" width="644" height="293" /></a> </p>  <p>Now reload the project. Open the project folder in Windows Explorer and go to the Properties folder. Add a new file&#160; called AppManifest.xml with the contents as shown below.</p>  <div style="border-bottom: gray 1px solid; border-left: gray 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; max-height: 200px; font-size: 8pt; overflow: auto; border-top: gray 1px solid; cursor: text; border-right: gray 1px solid; padding-top: 4px">   <div style="border-bottom-style: none; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">     <pre style="border-bottom-style: none; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060">   1:</span> <span style="color: #0000ff">&lt;</span><span style="color: #800000">Deployment</span> <span style="color: #ff0000">xmlns</span><span style="color: #0000ff">=&quot;http://schemas.microsoft.com/client/2007/deployment&quot;</span></pre><br /><br />    <pre style="border-bottom-style: none; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060">   2:</span>         <span style="color: #ff0000">xmlns:x</span><span style="color: #0000ff">=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span></pre><br /><br />    <pre style="border-bottom-style: none; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060">   3:</span> <span style="color: #0000ff">&gt;</span></pre><br /><br />    <pre style="border-bottom-style: none; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060">   4:</span>     <span style="color: #0000ff">&lt;</span><span style="color: #800000">Deployment.Parts</span><span style="color: #0000ff">&gt;</span></pre><br /><br />    <pre style="border-bottom-style: none; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060">   5:</span>     <span style="color: #0000ff">&lt;/</span><span style="color: #800000">Deployment.Parts</span><span style="color: #0000ff">&gt;</span></pre><br /><br />    <pre style="border-bottom-style: none; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060">   6:</span> <span style="color: #0000ff">&lt;/</span><span style="color: #800000">Deployment</span><span style="color: #0000ff">&gt;</span></pre><br />  </div><br /></div><br /><br /><p>Now come back to Visual Studio and click on the “Show All files” icon in Visual Studio Solution Explorer selecting the library project.</p><br /><br /><p><a href="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLdLMAX_I/AAAAAAAAA3A/RvE_65azCtg/s1600-h/image41.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLdKe3VxI/AAAAAAAAA3E/D7OFpXmmABs/image_thumb20.png?imgmax=800" width="223" height="123" /></a> </p><br /><br /><p>You should see AppManifest.xml without any icon associated. Right click on the xml file and click “Include in Project”.</p><br /><br /><p>Now go to the properties. The Silverlight tab should look like shown below. Specify the Xap Filename as you wish. Typically, I name it same as the Assembly name.</p><br /><br /><p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLdUsuE5I/AAAAAAAAA3I/jvJj8XL2XxQ/s1600-h/image38%5B1%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLduVLSKI/AAAAAAAAA3M/nVrZaY5bPPM/image_thumb19.png?imgmax=800" width="644" height="325" /></a> </p><br /><br /><p>My modified Silverlight Build options screen is shown below.</p><br /><br /><p><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLdzN3JzI/AAAAAAAAA3Q/sYKlap8JolQ/s1600-h/image49.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLd5uk-yI/AAAAAAAAA3U/DTXffD1rJsM/image_thumb26.png?imgmax=800" width="545" height="258" /></a> </p><br /><br /><p>Notice that I have also set the Manifest File template to the file that we added previously.</p><br /><br /><p><strong><u>Sub - Gotcha : This generates the XAP file. But it isn’t being copied to the ClientBin</u></strong></p><br /><br /><p>If you build the library project with the changes mentioned above, you can see the XAP file&#160; generated in the Debug folder but it would not automagically sit inside the ClientBin for the Web application project. To make this happen automatically, you have to modify the web application project properties. Right click on the web application project that contains your ClientBin. Go to the Silverlight Applications tab. Click on Add. Select your project and uncheck the “add a test page that references the control” since we do not want that. Shown below is that “Add Silverlight Application” screen. Finally click “Add”.</p><br /><br /><p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLeNPR8II/AAAAAAAAA3Y/1P1cxM213lo/s1600-h/image53.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLeVLYG7I/AAAAAAAAA3c/InL8qABPBh8/image_thumb28.png?imgmax=800" width="587" height="484" /></a> </p><br /><br /><p>Now build your solution and you should notice the XAP file being copied into the ClientBin folder.</p><br /><br /><p><strong><u>Gotcha 6 : Configuring Modules using XAML – ModuleCatalog : Always place the modules inside ModuleInfoGroup.</u></strong></p><br /><br /><p>Like mentioned previously, modules can be configured via an XAML file. This configuration allows one to specify if the modules be loaded as soon as they are available or when demanded. Lets assume that you have a XAP module which is to be loaded on demand and one which is to be loaded when available. Shown below is segment of my ModulesCatalog.xaml file whose complete version has been presented previously. Somehow, ModuleInfo when placed inside ModuleInfoGroup works where as just a ModuleInfo by itself always seemed not to work (may be I did something wrong).</p><br /><br /><p><a href="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLeSM7tfI/AAAAAAAAA3g/yGZRKkJuO4U/s1600-h/image%5B4%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLek3fMII/AAAAAAAAA3k/dNAlLTBU0Gw/image_thumb%5B1%5D.png?imgmax=800" width="644" height="148" /></a> </p><br /><br /><p><strong><u>So how to demand a module?</u></strong></p><br /><br /><p> _moduleManager.LoadModule(&quot;PerformanceCounterModule&quot;);</p><br /><br /><p>Where _moduleManager refers to the current ModuleManager instance. The best way to get this is to add ModuleManager parameter to the constructor and use UnityContainer to resolve the object. For example, shown below is one of the ViewModels that I use which has an instance of ModuleManager passed to its constructor. The ViewModel is not instantiated directly but instead obtained via “container.Resolve&lt;&gt;()” call.</p><br /><br /><p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLe9kg_EI/AAAAAAAAA3o/upMqUZRykrQ/s1600-h/image%5B8%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLfL1XCNI/AAAAAAAAA3s/GkBfiQCKwaw/image_thumb%5B3%5D.png?imgmax=800" width="644" height="190" /></a> </p><br /><br /><p>Unless implemented once, these concepts are rather difficult to understand. May be I will do a walkthrough for WPF based Twitter client very soon during which we can look at how it works out. For now, I assume you understand what I am talking about.</p><br /><br /><p><strong><u>Gotcha 7 :&#160; WCF Service with Silverlight Applications – Deployment, Libraries, etc….</u></strong></p><br /><br /><p>First of all, lets say you have a WCF service hosted inside the Web application. Lets say you created a Silverlight library which consumes this service, thereby you get to have a ServiceReferences.ClientConfig inside this helper client library but would not be present inside the shell application. Later when you deploy the service, it would be required that you modify the configuration files since the deployed service might have a different URI than the one at development. So to overcome this, shown below is one way that I often use. This simply obtains the service end point address and it assumes that the silverlight application and the service are both hosted within the same web application. All you need to look at is the way “_remoteAddress” is determined using Application.Current.Host.Source.</p><br /><br /><p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLftufRsI/AAAAAAAAA3w/shfNDJ0uEqY/s1600-h/image%5B12%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLf-ocAvI/AAAAAAAAA30/41Lou5XYtNs/image_thumb%5B5%5D.png?imgmax=800" width="644" height="412" /></a> </p><br /><br /><p>Now lets look at the application set up. Shown below is the shell project and the helper library which consumes the WCF service. Like I said before the library would be referenced and the WCF service is used instead of consuming the WCF service directly. (highlighted in the picture).</p><br /><br /><p><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SiBLgEiKm_I/AAAAAAAAA38/YsLPDpRkArc/s1600-h/image%5B16%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLgYqotYI/AAAAAAAAA4A/HeC3aMPVkvA/image_thumb%5B7%5D.png?imgmax=800" width="299" height="484" /></a> </p><br /><br /><p>So if you try and consume the service within the shell application you would compile and build without any issues. The namespaces would be figured out nicely (or use Ctrl + . in Visual Studio to resolve the namespace). But as you execute the application, you would face the exception shown below.</p><br /><br /><p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLgjO9ffI/AAAAAAAAA4E/v6Fh5po2ZVM/s1600-h/image3.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLg0WckKI/AAAAAAAAA4I/uuSBvWHtwTQ/image_thumb1.png?imgmax=800" width="531" height="239" /></a> </p><br /><br /><p>The message says “Cannot find ‘ServiceReferences.ClientConfig’ in the .xap application package”. And clearly we did not place one. But if we place one in here, it might be redundant and may later cause conflict issues which is not so easy to identify (since we might forget – remember DRY). </p><br /><br /><p>To resolve this, on the shell application (named maya in my case), </p><br /><br /><p>1. Right click on the project and click “Add Existing Item”. Navigate to the library which has the actual ClientConfig file. </p><br /><br /><p>2. Select the file (ServiceReferences.ClientConfig) and then instead of clicking add, click the arrow next to “add” and click “Add as Link”.</p><br /><br /><p>3. <strong>Remember we are adding a link. One mistake that I often do is to first click “Add as Link” and then select the file followed by clicking on &quot;Add” button. I assumed the drop down whenever clicked would change the behavior of the “Add” button but this isn’t the case. <u>You have to first select the file and then click on “Add as Link”</u>.</strong></p><br /><br /><p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/SiBLhPZBxDI/AAAAAAAAA4M/bqWY1Br3KfE/s1600-h/image10.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLhZBboOI/AAAAAAAAA4Q/eDX-7epLMi4/image_thumb4.png?imgmax=800" width="644" height="449" /></a></p><br /><br /><p>4. You can verify that its a linked copy by opening the shell application folder and you should not see any ClientConfig file. It should only be in the service layer library we added.</p><br /><br /><p><a href="http://lh5.ggpht.com/_Oy9HuksgrdU/SiBLhhUuLkI/AAAAAAAAA4U/NdLAcW9m9H0/s1600-h/image%5B20%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_Oy9HuksgrdU/SiBLhx9wHUI/AAAAAAAAA4Y/9EA-hhnbE68/image_thumb%5B9%5D.png?imgmax=800" width="644" height="417" /></a> </p><br /><br /><p><strong><u>Gotcha 8 : Last one … Silverlight XAP File size, Performance settings.</u></strong></p><br /><br /><p>1. Not sure if it matters much but you can actually extract the XAP file and re-zip it with a better utility like WinRar or 7-Zip and gain much smaller sized XAP files.</p><br /><br /><p>2. In the ASPX page that hosts the Silverlight content, you can add an attribute “MaxFrameRate” and set it to a lower value like 10. I have to be honest that I do not know if this setting would improve performance for any kind of silverlight applications or just the ones with media in it. Anyway I do it for any application I use.</p><br /><br /><p>I hope this post is informative enough and slightly well organized. <strong>I am not an expert in any of the technologies – composite silverlight apps, wcf or even Visual Studio.</strong> But i thought it would be a nice thing to share my observations with the community. So please be gentle if there is a mistake in my approach or my concepts and I would be glad to rectify them.</p><br /><br /><p>Thank you.</p>  