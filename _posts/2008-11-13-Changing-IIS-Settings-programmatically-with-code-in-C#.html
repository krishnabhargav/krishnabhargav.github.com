---           
layout: post
title: Changing IIS Settings programmatically with code in C#
date: 2008-11-13 15:09:35 UTC
updated: 2008-11-13 15:09:35 UTC
comments: false
categories: 
---

<p>The IIS Server maintains a number of Application Pools and each application pool can host one or more web applications. The application pool settings could be altered through IIS Manager (inetmgr). But it would be nice if one could change certain settings from the application pool through C# code. Shown below is the code to change the IdleTimeout for an application pool.   <br /><span style="color: blue">     <br />string </span><span style="color: black">metabasePath =</span><span style="color: maroon">&quot;IIS://localhost/W3SVC/AppPools&quot;</span><span style="color: black">;     <br /></span><span style="color: blue">string</span><span style="color: black">appPoolName =</span><span style="color: maroon">&quot;Classic .NET AppPool&quot;</span><span style="color: black">;     <br />DirectoryEntry apppools =</span><span style="color: blue">new</span><span style="color: black">DirectoryEntry(metabasePath);     <br /></span><span style="color: green">//This throws an exception - AccessViolationException     <br />//DirectoryEntry poolOfInterest =&#160; apppools.Children.Find</span><span style="color: green">(appPoolName);     <br /></span><span style="color: blue">foreach </span><span style="color: black">(DirectoryEntry p </span><span style="color: blue">in</span><span style="color: black">apppools.Children)     <br />{      <br /></span><span style="color: blue">if</span><span style="color: black">(p.Name == appPoolName)     <br />{      <br />&#160;&#160; Console.WriteLine(p.Name);      <br />&#160;&#160; Console.WriteLine(p.InvokeGet(</span><span style="color: maroon">&quot;IdleTimeout&quot;</span><span style="color: black">).ToString());     <br />&#160;&#160; p.InvokeSet(</span><span style="color: maroon">&quot;IdleTimeout&quot;</span><span style="color: black">,</span><span style="color: blue">new object</span><span style="color: black">[] {</span><span style="color: red">2</span><span style="color: black">});     <br />&#160;&#160; Console.WriteLine(p.InvokeGet(</span><span style="color: maroon">&quot;IdleTimeout&quot;</span><span style="color: black">).ToString());     <br />&#160;&#160; p.CommitChanges();      <br />&#160;&#160; </span><span style="color: blue">break</span><span style="color: black">;     <br />}      <br />}</span></p> <a href="http://11011.net/software/vspaste"></a>  <p><strong>Session timeout - Web.config settings are not good enough.</strong>    <br />Web Apps that needs to run for long durations under a user identity would face Session timeout issues eventually. I had a situation where the web application I work on was dying out after a while. The users who logged into the system are logged out after 20+ minutes. I thought this has to do with Session getting expired and so I made a change in the sessionState.timeout property in the web.config. But sounds like it is not good enough. The problem was not fixed and I decided I would debug the problem using Visual Studio. But I noticed the debugger no longer breaks after the session has died off. This stuck to me that the pool to which the debugger is attached to is no longer running and there might be a setting for Application Pool which tells the timeout. Then I found the IdleTimeout setting inside Application Pool defaults. The above is shown the code that you can use to change this value. Boom! works like magic.</p>  