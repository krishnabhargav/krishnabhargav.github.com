---           
layout: post
title: GridViewColumn CellTemplate does not work?
date: 2009-06-06 03:11:24 UTC
updated: 2009-06-06 03:11:24 UTC
comments: false
categories: 
---

<p>Well, today I came across this <a href="http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/cfb7da87-391a-4dae-af8b-bd6312e12881">interesting question on WPF</a> regarding setting the DataTemplate of a GridViewColumn not working properly. Everything looks fine in the code (assuming his DataTemplate generating method was fine) which got me interested to figure out what the issue is. </p>  <p>And then I made up this sample application whose XAML is shown below.</p>  <pre class="xml" name="code">&lt;Window x:Class=&quot;Window1&quot; <br />  xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; <br />  xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot; <br />  Title=&quot;Window1&quot; Height=&quot;300&quot; Width=&quot;300&quot; Loaded=&quot;Window_Loaded&quot;&gt; <br />&lt;StackPanel&gt; <br />&lt;ListView Name=&quot;lv&quot; ItemsSource=&quot;{Binding Items}&quot;&gt; <br />&lt;ListView.View&gt; <br />&lt;GridView&gt;&lt;/GridView&gt; <br />&lt;/ListView.View&gt; <br />&lt;/ListView&gt;<br />&lt;/StackPanel&gt; <br />&lt;/Window&gt;</pre><br /><br /><p>The code-behind is simple. It sets the DataContext to itself and then fetches sample data using GetData() call. Then the GridView for the ListView is obtained and a new gridviewcolumn is added programatically. The CellTemplate is set on the GridViewColumn using SampleTemplate() method. The SampleTemplate() method constructs a DataTemplate programatically using the FrameworkElementFactory class and returns the same. </p><br /><br /><p></p><br /><br /><pre class="vb" name="code"> <br />Private Sub Window_Loaded(ByVal sender As System.Object, _<br />                              ByVal e As System.Windows.RoutedEventArgs)<br />        Me.DataContext = Me 'set the datacontext<br />        Items = GetData()<br />        Dim gv As GridView = CType(lv.View, GridView)<br />        Dim gvc As New GridViewColumn<br />        gvc.Header = &quot;Test&quot;<br />        'Display member binding<br />        gvc.DisplayMemberBinding = New Binding(&quot;.&quot;)<br />        gvc.CellTemplate = SampleTemplate()<br />        gv.Columns.Add(gvc)<br />    End Sub<br /><br />    Private Function SampleTemplate() As DataTemplate<br />        Dim dt As New DataTemplate<br />        dt.DataType = GetType(String)<br />        Dim fef As New FrameworkElementFactory(GetType(TextBox))<br />        Dim bd As New Binding(&quot;.&quot;)<br />        fef.SetBinding(TextBox.TextProperty, bd)<br />        dt.VisualTree = fef<br />        Return dt<br />    End Function<br /><br />    Public Property Items() As IEnumerable(Of String)<br />        Get<br />            Return GetValue(ItemsProperty)<br />        End Get<br /><br />        Set(ByVal value As IEnumerable(Of String))<br />            SetValue(ItemsProperty, value)<br />        End Set<br />    End Property<br /><br />    Public Shared ReadOnly ItemsProperty As DependencyProperty = _<br />                           DependencyProperty.Register(&quot;Items&quot;, _<br />                           GetType(IEnumerable(Of String)), GetType(Window1), _<br />                           New FrameworkPropertyMetadata(Nothing))<br /><br />    Function GetData() As IEnumerable(Of String)<br />        Dim x As New ObservableCollection(Of String)<br />        x.Add(&quot;Item 1&quot;)<br />        x.Add(&quot;Item 2&quot;)<br />        x.Add(&quot;Item 3&quot;)<br />        Return x<br />    End Function</pre><br /><br /><p></p><br /><br /><p>And when I run the application all I see is â€¦</p><br /><br /><p><a href="http://lh4.ggpht.com/_Oy9HuksgrdU/SineHTrdfpI/AAAAAAAAA6E/UsyBBRERj1M/s1600-h/image%5B7%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_Oy9HuksgrdU/SineJP2xy0I/AAAAAAAAA6I/D3e-NkgT70o/image_thumb%5B3%5D.png?imgmax=800" width="244" height="244" /></a> </p><br /><br /><p>Ok the binding works and I see my data but somehow the celltemplate is not being reflected. So, I was able to reproduce the issue the question presented.</p><br /><br /><p>So I dig around and looked in the <a href="http://msdn.microsoft.com/en-us/library/system.windows.controls.gridviewcolumn.celltemplate.aspx">documentation for CellTemplate</a> where I found the following.</p><br /><br /><p><a href="http://lh3.ggpht.com/_Oy9HuksgrdU/SineJErRMfI/AAAAAAAAA6M/d-8zFrReFIc/s1600-h/image%5B4%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_Oy9HuksgrdU/SineJradgbI/AAAAAAAAA6Q/su90EFwS2gI/image_thumb%5B2%5D.png?imgmax=800" width="573" height="124" /></a> </p><br /><br /><p>So it basically means that if DisplayMemberBinding is used, then CellTemplate would be ignored and so on with the CellTemplateSelector. So I comment the line that sets DisplayMemberBinding and run again.</p><br /><br /><p><a href="http://lh6.ggpht.com/_Oy9HuksgrdU/SineJy1JX_I/AAAAAAAAA6U/d0_0VWZB74E/s1600-h/image%5B11%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_Oy9HuksgrdU/SineKSuNr1I/AAAAAAAAA6Y/8OVHo2RlAF4/image_thumb%5B5%5D.png?imgmax=800" width="466" height="484" /></a> </p><br /><br /><p></p><br /><br /><p></p><br /><br /><p>Yes! its working as expected.</p><br /><br /><p>So whats the moral of the story? Actually there are three morals:</p><br /><br /><p>1. First of all, when using CellTemplate, do not set DisplayMemberBinding.<br />  <br />2. Refer to the documentation, especially the remarks and code samples section for a method or property. MSDN folks did an amazing job (ofcourse the WPF guys as well).<br /><br />  <br />3. MSDN WPF Forums is amazing and overall Microsoft.NET folks rocks big time.</p>  